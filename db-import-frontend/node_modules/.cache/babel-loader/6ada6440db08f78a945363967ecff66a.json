{"ast":null,"code":"/*! @azure/msal-browser v2.37.0 2023-05-01 */\n'use strict';\n\nimport { __awaiter, __generator } from '../_virtual/_tslib.js';\nimport { Constants } from '@azure/msal-common';\nimport { KEY_FORMAT_JWK } from '../utils/BrowserConstants.js';\nimport { BrowserStringUtils } from '../utils/BrowserStringUtils.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\nvar MsBrowserCrypto = /** @class */function () {\n  function MsBrowserCrypto() {}\n  MsBrowserCrypto.prototype.getRandomValues = function (dataBuffer) {\n    return window[\"msCrypto\"].getRandomValues(dataBuffer);\n  };\n  MsBrowserCrypto.prototype.generateKey = function (algorithm, extractable, keyUsages) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          var msGenerateKey = window[\"msCrypto\"].subtle.generateKey(algorithm, extractable, keyUsages);\n          msGenerateKey.addEventListener(\"complete\", function (e) {\n            resolve(e.target.result);\n          });\n          msGenerateKey.addEventListener(\"error\", function (error) {\n            reject(error);\n          });\n        })];\n      });\n    });\n  };\n  MsBrowserCrypto.prototype.exportKey = function (key) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          var msExportKey = window[\"msCrypto\"].subtle.exportKey(KEY_FORMAT_JWK, key);\n          msExportKey.addEventListener(\"complete\", function (e) {\n            var resultBuffer = e.target.result;\n            var resultString = BrowserStringUtils.utf8ArrToString(new Uint8Array(resultBuffer)).replace(/\\r/g, Constants.EMPTY_STRING).replace(/\\n/g, Constants.EMPTY_STRING).replace(/\\t/g, Constants.EMPTY_STRING).split(\" \").join(Constants.EMPTY_STRING).replace(\"\\0\", Constants.EMPTY_STRING);\n            try {\n              resolve(JSON.parse(resultString));\n            } catch (e) {\n              reject(e);\n            }\n          });\n          msExportKey.addEventListener(\"error\", function (error) {\n            reject(error);\n          });\n        })];\n      });\n    });\n  };\n  MsBrowserCrypto.prototype.importKey = function (keyData, algorithm, extractable, keyUsages) {\n    return __awaiter(this, void 0, void 0, function () {\n      var keyString, keyBuffer;\n      return __generator(this, function (_a) {\n        keyString = BrowserStringUtils.getSortedObjectString(keyData);\n        keyBuffer = BrowserStringUtils.stringToArrayBuffer(keyString);\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          var msImportKey = window[\"msCrypto\"].subtle.importKey(KEY_FORMAT_JWK, keyBuffer, algorithm, extractable, keyUsages);\n          msImportKey.addEventListener(\"complete\", function (e) {\n            resolve(e.target.result);\n          });\n          msImportKey.addEventListener(\"error\", function (error) {\n            reject(error);\n          });\n        })];\n      });\n    });\n  };\n  MsBrowserCrypto.prototype.sign = function (algorithm, key, data) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          var msSign = window[\"msCrypto\"].subtle.sign(algorithm, key, data);\n          msSign.addEventListener(\"complete\", function (e) {\n            resolve(e.target.result);\n          });\n          msSign.addEventListener(\"error\", function (error) {\n            reject(error);\n          });\n        })];\n      });\n    });\n  };\n  MsBrowserCrypto.prototype.digest = function (algorithm, data) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          var digestOperation = window[\"msCrypto\"].subtle.digest(algorithm, data.buffer);\n          digestOperation.addEventListener(\"complete\", function (e) {\n            resolve(e.target.result);\n          });\n          digestOperation.addEventListener(\"error\", function (error) {\n            reject(error);\n          });\n        })];\n      });\n    });\n  };\n  return MsBrowserCrypto;\n}();\nexport { MsBrowserCrypto };","map":{"version":3,"names":["MsBrowserCrypto","prototype","getRandomValues","dataBuffer","window","generateKey","algorithm","extractable","keyUsages","Promise","resolve","reject","msGenerateKey","subtle","addEventListener","e","target","result","error","exportKey","key","msExportKey","KEY_FORMAT_JWK","resultBuffer","resultString","BrowserStringUtils","utf8ArrToString","Uint8Array","replace","Constants","EMPTY_STRING","split","join","JSON","parse","importKey","keyData","keyString","getSortedObjectString","keyBuffer","stringToArrayBuffer","msImportKey","sign","data","msSign","digest","digestOperation","buffer"],"sources":["../../src/crypto/MsBrowserCrypto.ts"],"sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Constants } from \"@azure/msal-common\";\r\nimport { KEY_FORMAT_JWK } from \"../utils/BrowserConstants\";\r\nimport { BrowserStringUtils } from \"../utils/BrowserStringUtils\";\r\nimport { ISubtleCrypto } from \"./ISubtleCrypto\";\r\n\r\nexport class MsBrowserCrypto implements ISubtleCrypto {\r\n    getRandomValues(dataBuffer: Uint8Array): Uint8Array {\r\n        return window[\"msCrypto\"].getRandomValues(dataBuffer);\r\n    }\r\n\r\n    async generateKey(algorithm: RsaHashedKeyGenParams, extractable: boolean, keyUsages: KeyUsage[]): Promise<CryptoKeyPair> {\r\n        return new Promise((resolve: Function, reject: Function) => {\r\n            const msGenerateKey = window[\"msCrypto\"].subtle.generateKey(algorithm, extractable, keyUsages);\r\n            msGenerateKey.addEventListener(\"complete\", (e: { target: { result: CryptoKeyPair | PromiseLike<CryptoKeyPair>; }; }) => {\r\n                resolve(e.target.result);\r\n            });\r\n\r\n            msGenerateKey.addEventListener(\"error\", (error: string) => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async exportKey(key: CryptoKey): Promise<JsonWebKey> {\r\n        return new Promise((resolve: Function, reject: Function) => {\r\n            const msExportKey = window[\"msCrypto\"].subtle.exportKey(KEY_FORMAT_JWK, key);\r\n            msExportKey.addEventListener(\"complete\", (e: { target: { result: ArrayBuffer; }; }) => {\r\n                const resultBuffer: ArrayBuffer = e.target.result;\r\n\r\n                const resultString = BrowserStringUtils.utf8ArrToString(new Uint8Array(resultBuffer))\r\n                    .replace(/\\r/g, Constants.EMPTY_STRING)\r\n                    .replace(/\\n/g, Constants.EMPTY_STRING)\r\n                    .replace(/\\t/g, Constants.EMPTY_STRING)\r\n                    .split(\" \").join(Constants.EMPTY_STRING)\r\n                    .replace(\"\\u0000\", Constants.EMPTY_STRING);\r\n\r\n                try {\r\n                    resolve(JSON.parse(resultString));\r\n                } catch (e) {\r\n                    reject(e);\r\n                }\r\n            });\r\n\r\n            msExportKey.addEventListener(\"error\", (error: string) => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async importKey(keyData: JsonWebKey, algorithm: RsaHashedImportParams, extractable: boolean, keyUsages: KeyUsage[]): Promise<CryptoKey> {\r\n        const keyString = BrowserStringUtils.getSortedObjectString(keyData);\r\n        const keyBuffer = BrowserStringUtils.stringToArrayBuffer(keyString);\r\n\r\n        return new Promise((resolve: Function, reject: Function) => {\r\n            const msImportKey = window[\"msCrypto\"].subtle.importKey(KEY_FORMAT_JWK, keyBuffer, algorithm, extractable, keyUsages);\r\n            msImportKey.addEventListener(\"complete\", (e: { target: { result: CryptoKey | PromiseLike<CryptoKey>; }; }) => {\r\n                resolve(e.target.result);\r\n            });\r\n\r\n            msImportKey.addEventListener(\"error\", (error: string) => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async sign(algorithm: AlgorithmIdentifier, key: CryptoKey, data: ArrayBuffer): Promise<ArrayBuffer> {\r\n        return new Promise((resolve: Function, reject: Function) => {\r\n            const msSign = window[\"msCrypto\"].subtle.sign(algorithm, key, data);\r\n            msSign.addEventListener(\"complete\", (e: { target: { result: ArrayBuffer | PromiseLike<ArrayBuffer>; }; }) => {\r\n                resolve(e.target.result);\r\n            });\r\n\r\n            msSign.addEventListener(\"error\", (error: string) => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n    \r\n    async digest(algorithm: AlgorithmIdentifier, data: Uint8Array): Promise<ArrayBuffer> {\r\n        return new Promise((resolve, reject) => {\r\n            const digestOperation = window[\"msCrypto\"].subtle.digest(algorithm, data.buffer);\r\n            digestOperation.addEventListener(\"complete\", (e: { target: { result: ArrayBuffer | PromiseLike<ArrayBuffer>; }; }) => {\r\n                resolve(e.target.result);\r\n            });\r\n            digestOperation.addEventListener(\"error\", (error: string) => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}