{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/aribraun/Desktop/db-import/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _classCallCheck = require(\"/Users/aribraun/Desktop/db-import/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/aribraun/Desktop/db-import/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _inherits = require(\"/Users/aribraun/Desktop/db-import/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/Users/aribraun/Desktop/db-import/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar net_1 = __importDefault(require(\"net\"));\nvar tls_1 = __importDefault(require(\"tls\"));\nvar url_1 = __importDefault(require(\"url\"));\nvar debug_1 = __importDefault(require(\"debug\"));\nvar once_1 = __importDefault(require(\"@tootallnate/once\"));\nvar agent_base_1 = require(\"agent-base\");\nvar debug = debug_1.default('http-proxy-agent');\nfunction isHTTPS(protocol) {\n  return typeof protocol === 'string' ? /^https:?$/i.test(protocol) : false;\n}\n/**\n * The `HttpProxyAgent` implements an HTTP Agent subclass that connects\n * to the specified \"HTTP proxy server\" in order to proxy HTTP requests.\n *\n * @api public\n */\nvar HttpProxyAgent = /*#__PURE__*/function (_agent_base_1$Agent) {\n  _inherits(HttpProxyAgent, _agent_base_1$Agent);\n  var _super = _createSuper(HttpProxyAgent);\n  function HttpProxyAgent(_opts) {\n    var _this;\n    _classCallCheck(this, HttpProxyAgent);\n    var opts;\n    if (typeof _opts === 'string') {\n      opts = url_1.default.parse(_opts);\n    } else {\n      opts = _opts;\n    }\n    if (!opts) {\n      throw new Error('an HTTP(S) proxy server `host` and `port` must be specified!');\n    }\n    debug('Creating new HttpProxyAgent instance: %o', opts);\n    _this = _super.call(this, opts);\n    var proxy = Object.assign({}, opts);\n    // If `true`, then connect to the proxy server over TLS.\n    // Defaults to `false`.\n    _this.secureProxy = opts.secureProxy || isHTTPS(proxy.protocol);\n    // Prefer `hostname` over `host`, and set the `port` if needed.\n    proxy.host = proxy.hostname || proxy.host;\n    if (typeof proxy.port === 'string') {\n      proxy.port = parseInt(proxy.port, 10);\n    }\n    if (!proxy.port && proxy.host) {\n      proxy.port = _this.secureProxy ? 443 : 80;\n    }\n    if (proxy.host && proxy.path) {\n      // If both a `host` and `path` are specified then it's most likely\n      // the result of a `url.parse()` call... we need to remove the\n      // `path` portion so that `net.connect()` doesn't attempt to open\n      // that as a Unix socket file.\n      delete proxy.path;\n      delete proxy.pathname;\n    }\n    _this.proxy = proxy;\n    return _this;\n  }\n  /**\n   * Called when the node-core HTTP client library is creating a\n   * new HTTP request.\n   *\n   * @api protected\n   */\n  _createClass(HttpProxyAgent, [{\n    key: \"callback\",\n    value: function callback(req, opts) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var proxy, secureProxy, parsed, socket, first, endOfHeaders;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              proxy = this.proxy, secureProxy = this.secureProxy;\n              parsed = url_1.default.parse(req.path);\n              if (!parsed.protocol) {\n                parsed.protocol = 'http:';\n              }\n              if (!parsed.hostname) {\n                parsed.hostname = opts.hostname || opts.host || null;\n              }\n              if (parsed.port == null && typeof opts.port) {\n                parsed.port = String(opts.port);\n              }\n              if (parsed.port === '80') {\n                // if port is 80, then we can remove the port so that the\n                // \":80\" portion is not on the produced URL\n                delete parsed.port;\n              }\n              // Change the `http.ClientRequest` instance's \"path\" field\n              // to the absolute path of the URL that will be requested.\n              req.path = url_1.default.format(parsed);\n              // Inject the `Proxy-Authorization` header if necessary.\n              if (proxy.auth) {\n                req.setHeader('Proxy-Authorization', \"Basic \".concat(Buffer.from(proxy.auth).toString('base64')));\n              }\n              // Create a socket connection to the proxy server.\n\n              if (secureProxy) {\n                debug('Creating `tls.Socket`: %o', proxy);\n                socket = tls_1.default.connect(proxy);\n              } else {\n                debug('Creating `net.Socket`: %o', proxy);\n                socket = net_1.default.connect(proxy);\n              }\n              // At this point, the http ClientRequest's internal `_header` field\n              // might have already been set. If this is the case then we'll need\n              // to re-generate the string since we just changed the `req.path`.\n              if (req._header) {\n                debug('Regenerating stored HTTP header string for request');\n                req._header = null;\n                req._implicitHeader();\n                if (req.output && req.output.length > 0) {\n                  // Node < 12\n                  debug('Patching connection write() output buffer with updated header');\n                  first = req.output[0];\n                  endOfHeaders = first.indexOf('\\r\\n\\r\\n') + 4;\n                  req.output[0] = req._header + first.substring(endOfHeaders);\n                  debug('Output buffer: %o', req.output);\n                } else if (req.outputData && req.outputData.length > 0) {\n                  // Node >= 12\n                  debug('Patching connection write() output buffer with updated header');\n                  first = req.outputData[0].data;\n                  endOfHeaders = first.indexOf('\\r\\n\\r\\n') + 4;\n                  req.outputData[0].data = req._header + first.substring(endOfHeaders);\n                  debug('Output buffer: %o', req.outputData[0].data);\n                }\n              }\n              // Wait for the socket's `connect` event, so that this `callback()`\n              // function throws instead of the `http` request machinery. This is\n              // important for i.e. `PacProxyAgent` which determines a failed proxy\n              // connection via the `callback()` function throwing.\n              _context.next = 12;\n              return once_1.default(socket, 'connect');\n            case 12:\n              return _context.abrupt(\"return\", socket);\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n    }\n  }]);\n  return HttpProxyAgent;\n}(agent_base_1.Agent);\nexports.default = HttpProxyAgent;","map":{"version":3,"names":["net_1","__importDefault","require","tls_1","url_1","debug_1","once_1","agent_base_1","debug","default","isHTTPS","protocol","test","HttpProxyAgent","_agent_base_1$Agent","_inherits","_super","_createSuper","_opts","_this","_classCallCheck","opts","parse","Error","call","proxy","Object","assign","secureProxy","host","hostname","port","parseInt","path","pathname","_createClass","key","value","callback","req","parsed","String","format","auth","setHeader","concat","Buffer","from","toString","socket","connect","_header","_implicitHeader","output","length","first","endOfHeaders","indexOf","substring","outputData","data","_context","next","abrupt","stop","_callee","Agent","exports"],"sources":["../src/agent.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}