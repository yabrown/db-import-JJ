{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { AbortError } from \"@azure/abort-controller\";\n/**\n * Creates an abortable promise.\n * @param buildPromise - A function that takes the resolve and reject functions as parameters.\n * @param options - The options for the abortable promise.\n * @returns A promise that can be aborted.\n */\nexport function createAbortablePromise(buildPromise, options) {\n  var _ref = options !== null && options !== void 0 ? options : {},\n    cleanupBeforeAbort = _ref.cleanupBeforeAbort,\n    abortSignal = _ref.abortSignal,\n    abortErrorMsg = _ref.abortErrorMsg;\n  return new Promise(function (resolve, reject) {\n    function rejectOnAbort() {\n      reject(new AbortError(abortErrorMsg !== null && abortErrorMsg !== void 0 ? abortErrorMsg : \"The operation was aborted.\"));\n    }\n    function removeListeners() {\n      abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.removeEventListener(\"abort\", onAbort);\n    }\n    function onAbort() {\n      cleanupBeforeAbort === null || cleanupBeforeAbort === void 0 ? void 0 : cleanupBeforeAbort();\n      removeListeners();\n      rejectOnAbort();\n    }\n    if (abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.aborted) {\n      return rejectOnAbort();\n    }\n    try {\n      buildPromise(function (x) {\n        removeListeners();\n        resolve(x);\n      }, function (x) {\n        removeListeners();\n        reject(x);\n      });\n    } catch (err) {\n      reject(err);\n    }\n    abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.addEventListener(\"abort\", onAbort);\n  });\n}","map":{"version":3,"names":["AbortError","createAbortablePromise","buildPromise","options","_ref","cleanupBeforeAbort","abortSignal","abortErrorMsg","Promise","resolve","reject","rejectOnAbort","removeListeners","removeEventListener","onAbort","aborted","x","err","addEventListener"],"sources":["../../src/createAbortablePromise.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { AbortError, AbortSignalLike } from \"@azure/abort-controller\";\n\n/**\n * Options for the createAbortablePromise function.\n */\nexport interface CreateAbortablePromiseOptions {\n  /** A function to be called if the promise was aborted */\n  cleanupBeforeAbort?: () => void;\n  /** An abort signal */\n  abortSignal?: AbortSignalLike;\n  /** An abort error message */\n  abortErrorMsg?: string;\n}\n\n/**\n * Creates an abortable promise.\n * @param buildPromise - A function that takes the resolve and reject functions as parameters.\n * @param options - The options for the abortable promise.\n * @returns A promise that can be aborted.\n */\nexport function createAbortablePromise<T>(\n  buildPromise: (\n    resolve: (value: T | PromiseLike<T>) => void,\n    reject: (reason?: any) => void\n  ) => void,\n  options?: CreateAbortablePromiseOptions\n): Promise<T> {\n  const { cleanupBeforeAbort, abortSignal, abortErrorMsg } = options ?? {};\n  return new Promise((resolve, reject) => {\n    function rejectOnAbort(): void {\n      reject(new AbortError(abortErrorMsg ?? \"The operation was aborted.\"));\n    }\n    function removeListeners(): void {\n      abortSignal?.removeEventListener(\"abort\", onAbort);\n    }\n    function onAbort(): void {\n      cleanupBeforeAbort?.();\n      removeListeners();\n      rejectOnAbort();\n    }\n    if (abortSignal?.aborted) {\n      return rejectOnAbort();\n    }\n    try {\n      buildPromise(\n        (x) => {\n          removeListeners();\n          resolve(x);\n        },\n        (x) => {\n          removeListeners();\n          reject(x);\n        }\n      );\n    } catch (err) {\n      reject(err);\n    }\n    abortSignal?.addEventListener(\"abort\", onAbort);\n  });\n}\n"],"mappings":"AAAA;AACA;AAEA,SAASA,UAAU,QAAyB,yBAAyB;AAcrE;;;;;;AAMA,OAAM,SAAUC,sBAAsBA,CACpCC,YAGS,EACTC,OAAuC;EAEvC,IAAAC,IAAA,GAA2DD,OAAO,aAAPA,OAAO,cAAPA,OAAO,GAAI,EAAE;IAAhEE,kBAAkB,GAAAD,IAAA,CAAlBC,kBAAkB;IAAEC,WAAW,GAAAF,IAAA,CAAXE,WAAW;IAAEC,aAAa,GAAAH,IAAA,CAAbG,aAAa;EACtD,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAI;IACrC,SAASC,aAAaA,CAAA;MACpBD,MAAM,CAAC,IAAIV,UAAU,CAACO,aAAa,aAAbA,aAAa,cAAbA,aAAa,GAAI,4BAA4B,CAAC,CAAC;IACvE;IACA,SAASK,eAAeA,CAAA;MACtBN,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEO,mBAAmB,CAAC,OAAO,EAAEC,OAAO,CAAC;IACpD;IACA,SAASA,OAAOA,CAAA;MACdT,kBAAkB,aAAlBA,kBAAkB,uBAAlBA,kBAAkB,EAAI;MACtBO,eAAe,EAAE;MACjBD,aAAa,EAAE;IACjB;IACA,IAAIL,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAES,OAAO,EAAE;MACxB,OAAOJ,aAAa,EAAE;;IAExB,IAAI;MACFT,YAAY,CACV,UAACc,CAAC,EAAI;QACJJ,eAAe,EAAE;QACjBH,OAAO,CAACO,CAAC,CAAC;MACZ,CAAC,EACD,UAACA,CAAC,EAAI;QACJJ,eAAe,EAAE;QACjBF,MAAM,CAACM,CAAC,CAAC;MACX,CAAC,CACF;KACF,CAAC,OAAOC,GAAG,EAAE;MACZP,MAAM,CAACO,GAAG,CAAC;;IAEbX,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEY,gBAAgB,CAAC,OAAO,EAAEJ,OAAO,CAAC;EACjD,CAAC,CAAC;AACJ"},"metadata":{},"sourceType":"module"}