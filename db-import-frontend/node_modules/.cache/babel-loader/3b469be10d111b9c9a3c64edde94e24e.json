{"ast":null,"code":"\"use strict\";\n\nvar _ = require(\"lodash\");\nvar HasOne = require(\"./has-one\");\nvar HasMany = require(\"./has-many\");\nvar BelongsToMany = require(\"./belongs-to-many\");\nvar BelongsTo = require(\"./belongs-to\");\nfunction isModel(model, sequelize) {\n  return model && model.prototype && model.prototype instanceof sequelize.Sequelize.Model;\n}\nvar Mixin = {\n  hasMany: function hasMany(target) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!isModel(target, this.sequelize)) {\n      throw new Error(\"\".concat(this.name, \".hasMany called with something that's not a subclass of Sequelize.Model\"));\n    }\n    var source = this;\n    options.hooks = options.hooks === void 0 ? false : Boolean(options.hooks);\n    options.useHooks = options.hooks;\n    Object.assign(options, _.omit(source.options, [\"hooks\"]));\n    if (options.useHooks) {\n      this.runHooks(\"beforeAssociate\", {\n        source: source,\n        target: target,\n        type: HasMany\n      }, options);\n    }\n    var association = new HasMany(source, target, options);\n    source.associations[association.associationAccessor] = association;\n    association._injectAttributes();\n    association.mixin(source.prototype);\n    if (options.useHooks) {\n      this.runHooks(\"afterAssociate\", {\n        source: source,\n        target: target,\n        type: HasMany,\n        association: association\n      }, options);\n    }\n    return association;\n  },\n  belongsToMany: function belongsToMany(target) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    if (!isModel(target, this.sequelize)) {\n      throw new Error(\"\".concat(this.name, \".belongsToMany called with something that's not a subclass of Sequelize.Model\"));\n    }\n    var source = this;\n    options.hooks = options.hooks === void 0 ? false : Boolean(options.hooks);\n    options.useHooks = options.hooks;\n    options.timestamps = options.timestamps === void 0 ? this.sequelize.options.timestamps : options.timestamps;\n    Object.assign(options, _.omit(source.options, [\"hooks\", \"timestamps\", \"scopes\", \"defaultScope\"]));\n    if (options.useHooks) {\n      this.runHooks(\"beforeAssociate\", {\n        source: source,\n        target: target,\n        type: BelongsToMany\n      }, options);\n    }\n    var association = new BelongsToMany(source, target, options);\n    source.associations[association.associationAccessor] = association;\n    association._injectAttributes();\n    association.mixin(source.prototype);\n    if (options.useHooks) {\n      this.runHooks(\"afterAssociate\", {\n        source: source,\n        target: target,\n        type: BelongsToMany,\n        association: association\n      }, options);\n    }\n    return association;\n  },\n  getAssociations: function getAssociations(target) {\n    return Object.values(this.associations).filter(function (association) {\n      return association.target.name === target.name;\n    });\n  },\n  getAssociationForAlias: function getAssociationForAlias(target, alias) {\n    return this.getAssociations(target).find(function (association) {\n      return association.verifyAssociationAlias(alias);\n    }) || null;\n  }\n};\nfunction singleLinked(Type) {\n  return function (target) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var source = this;\n    if (!isModel(target, source.sequelize)) {\n      throw new Error(\"\".concat(source.name, \".\").concat(_.lowerFirst(Type.name), \" called with something that's not a subclass of Sequelize.Model\"));\n    }\n    options.hooks = options.hooks === void 0 ? false : Boolean(options.hooks);\n    options.useHooks = options.hooks;\n    if (options.useHooks) {\n      source.runHooks(\"beforeAssociate\", {\n        source: source,\n        target: target,\n        type: Type\n      }, options);\n    }\n    var association = new Type(source, target, Object.assign(options, source.options));\n    source.associations[association.associationAccessor] = association;\n    association._injectAttributes();\n    association.mixin(source.prototype);\n    if (options.useHooks) {\n      source.runHooks(\"afterAssociate\", {\n        source: source,\n        target: target,\n        type: Type,\n        association: association\n      }, options);\n    }\n    return association;\n  };\n}\nMixin.hasOne = singleLinked(HasOne);\nMixin.belongsTo = singleLinked(BelongsTo);\nmodule.exports = Mixin;\nmodule.exports.Mixin = Mixin;\nmodule.exports.default = Mixin;","map":{"version":3,"names":["_","require","HasOne","HasMany","BelongsToMany","BelongsTo","isModel","model","sequelize","prototype","Sequelize","Model","Mixin","hasMany","target","options","arguments","length","undefined","Error","concat","name","source","hooks","Boolean","useHooks","Object","assign","omit","runHooks","type","association","associations","associationAccessor","_injectAttributes","mixin","belongsToMany","timestamps","getAssociations","values","filter","getAssociationForAlias","alias","find","verifyAssociationAlias","singleLinked","Type","lowerFirst","hasOne","belongsTo","module","exports","default"],"sources":["../../src/associations/mixin.js"],"sourcesContent":["'use strict';\n\nconst _ = require('lodash');\nconst HasOne = require('./has-one');\nconst HasMany = require('./has-many');\nconst BelongsToMany = require('./belongs-to-many');\nconst BelongsTo = require('./belongs-to');\n\nfunction isModel(model, sequelize) {\n  return model\n    && model.prototype\n    && model.prototype instanceof sequelize.Sequelize.Model;\n}\n\nconst Mixin = {\n  hasMany(target, options = {}) {\n    if (!isModel(target, this.sequelize)) {\n      throw new Error(`${this.name}.hasMany called with something that's not a subclass of Sequelize.Model`);\n    }\n\n    const source = this;\n\n    // Since this is a mixin, we'll need a unique letiable name for hooks (since Model will override our hooks option)\n    options.hooks = options.hooks === undefined ? false : Boolean(options.hooks);\n    options.useHooks = options.hooks;\n\n    Object.assign(options, _.omit(source.options, ['hooks']));\n\n    if (options.useHooks) {\n      this.runHooks('beforeAssociate', { source, target, type: HasMany }, options);\n    }\n\n    // the id is in the foreign table or in a connecting table\n    const association = new HasMany(source, target, options);\n    source.associations[association.associationAccessor] = association;\n\n    association._injectAttributes();\n    association.mixin(source.prototype);\n\n    if (options.useHooks) {\n      this.runHooks('afterAssociate', { source, target, type: HasMany, association }, options);\n    }\n\n    return association;\n  },\n\n  belongsToMany(target, options = {}) {\n    if (!isModel(target, this.sequelize)) {\n      throw new Error(`${this.name}.belongsToMany called with something that's not a subclass of Sequelize.Model`);\n    }\n\n    const source = this;\n\n    // Since this is a mixin, we'll need a unique letiable name for hooks (since Model will override our hooks option)\n    options.hooks = options.hooks === undefined ? false : Boolean(options.hooks);\n    options.useHooks = options.hooks;\n    options.timestamps = options.timestamps === undefined ? this.sequelize.options.timestamps : options.timestamps;\n    Object.assign(options, _.omit(source.options, ['hooks', 'timestamps', 'scopes', 'defaultScope']));\n\n    if (options.useHooks) {\n      this.runHooks('beforeAssociate', { source, target, type: BelongsToMany }, options);\n    }\n    // the id is in the foreign table or in a connecting table\n    const association = new BelongsToMany(source, target, options);\n    source.associations[association.associationAccessor] = association;\n\n    association._injectAttributes();\n    association.mixin(source.prototype);\n\n    if (options.useHooks) {\n      this.runHooks('afterAssociate', { source, target, type: BelongsToMany, association }, options);\n    }\n\n    return association;\n  },\n\n  getAssociations(target) {\n    return Object.values(this.associations).filter(association => association.target.name === target.name);\n  },\n\n  getAssociationForAlias(target, alias) {\n    // Two associations cannot have the same alias, so we can use find instead of filter\n    return this.getAssociations(target).find(association => association.verifyAssociationAlias(alias)) || null;\n  }\n};\n\n// The logic for hasOne and belongsTo is exactly the same\nfunction singleLinked(Type) {\n  return function(target, options = {}) {\n    // eslint-disable-next-line no-invalid-this\n    const source = this;\n    if (!isModel(target, source.sequelize)) {\n      throw new Error(`${source.name}.${_.lowerFirst(Type.name)} called with something that's not a subclass of Sequelize.Model`);\n    }\n\n\n    // Since this is a mixin, we'll need a unique letiable name for hooks (since Model will override our hooks option)\n    options.hooks = options.hooks === undefined ? false : Boolean(options.hooks);\n    options.useHooks = options.hooks;\n\n    if (options.useHooks) {\n      source.runHooks('beforeAssociate', { source, target, type: Type }, options);\n    }\n    // the id is in the foreign table\n    const association = new Type(source, target, Object.assign(options, source.options));\n    source.associations[association.associationAccessor] = association;\n\n    association._injectAttributes();\n    association.mixin(source.prototype);\n\n    if (options.useHooks) {\n      source.runHooks('afterAssociate', { source, target, type: Type, association }, options);\n    }\n\n    return association;\n  };\n}\n\nMixin.hasOne = singleLinked(HasOne);\nMixin.belongsTo = singleLinked(BelongsTo);\n\nmodule.exports = Mixin;\nmodule.exports.Mixin = Mixin;\nmodule.exports.default = Mixin;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}