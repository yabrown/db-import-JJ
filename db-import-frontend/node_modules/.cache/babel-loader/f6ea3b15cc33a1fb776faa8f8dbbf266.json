{"ast":null,"code":"/*! @azure/msal-common v13.0.0 2023-05-01 */\n'use strict';\n\nimport { SERVER_TELEM_CONSTANTS, CacheOutcome, Constants, Separators } from '../../utils/Constants.js';\nimport { ServerTelemetryEntity } from '../../cache/entities/ServerTelemetryEntity.js';\nimport { StringUtils } from '../../utils/StringUtils.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\nvar ServerTelemetryManager = /** @class */function () {\n  function ServerTelemetryManager(telemetryRequest, cacheManager) {\n    this.cacheOutcome = CacheOutcome.NO_CACHE_HIT;\n    this.cacheManager = cacheManager;\n    this.apiId = telemetryRequest.apiId;\n    this.correlationId = telemetryRequest.correlationId;\n    this.wrapperSKU = telemetryRequest.wrapperSKU || Constants.EMPTY_STRING;\n    this.wrapperVer = telemetryRequest.wrapperVer || Constants.EMPTY_STRING;\n    this.telemetryCacheKey = SERVER_TELEM_CONSTANTS.CACHE_KEY + Separators.CACHE_KEY_SEPARATOR + telemetryRequest.clientId;\n  }\n  /**\r\n   * API to add MSER Telemetry to request\r\n   */\n  ServerTelemetryManager.prototype.generateCurrentRequestHeaderValue = function () {\n    var request = \"\" + this.apiId + SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR + this.cacheOutcome;\n    var platformFields = [this.wrapperSKU, this.wrapperVer].join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n    var regionDiscoveryFields = this.getRegionDiscoveryFields();\n    var requestWithRegionDiscoveryFields = [request, regionDiscoveryFields].join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n    return [SERVER_TELEM_CONSTANTS.SCHEMA_VERSION, requestWithRegionDiscoveryFields, platformFields].join(SERVER_TELEM_CONSTANTS.CATEGORY_SEPARATOR);\n  };\n  /**\r\n   * API to add MSER Telemetry for the last failed request\r\n   */\n  ServerTelemetryManager.prototype.generateLastRequestHeaderValue = function () {\n    var lastRequests = this.getLastRequests();\n    var maxErrors = ServerTelemetryManager.maxErrorsToSend(lastRequests);\n    var failedRequests = lastRequests.failedRequests.slice(0, 2 * maxErrors).join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n    var errors = lastRequests.errors.slice(0, maxErrors).join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n    var errorCount = lastRequests.errors.length;\n    // Indicate whether this header contains all data or partial data\n    var overflow = maxErrors < errorCount ? SERVER_TELEM_CONSTANTS.OVERFLOW_TRUE : SERVER_TELEM_CONSTANTS.OVERFLOW_FALSE;\n    var platformFields = [errorCount, overflow].join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n    return [SERVER_TELEM_CONSTANTS.SCHEMA_VERSION, lastRequests.cacheHits, failedRequests, errors, platformFields].join(SERVER_TELEM_CONSTANTS.CATEGORY_SEPARATOR);\n  };\n  /**\r\n   * API to cache token failures for MSER data capture\r\n   * @param error\r\n   */\n  ServerTelemetryManager.prototype.cacheFailedRequest = function (error) {\n    var lastRequests = this.getLastRequests();\n    if (lastRequests.errors.length >= SERVER_TELEM_CONSTANTS.MAX_CACHED_ERRORS) {\n      // Remove a cached error to make room, first in first out\n      lastRequests.failedRequests.shift(); // apiId\n      lastRequests.failedRequests.shift(); // correlationId\n      lastRequests.errors.shift();\n    }\n    lastRequests.failedRequests.push(this.apiId, this.correlationId);\n    if (!StringUtils.isEmpty(error.subError)) {\n      lastRequests.errors.push(error.subError);\n    } else if (!StringUtils.isEmpty(error.errorCode)) {\n      lastRequests.errors.push(error.errorCode);\n    } else if (!!error && error.toString()) {\n      lastRequests.errors.push(error.toString());\n    } else {\n      lastRequests.errors.push(SERVER_TELEM_CONSTANTS.UNKNOWN_ERROR);\n    }\n    this.cacheManager.setServerTelemetry(this.telemetryCacheKey, lastRequests);\n    return;\n  };\n  /**\r\n   * Update server telemetry cache entry by incrementing cache hit counter\r\n   */\n  ServerTelemetryManager.prototype.incrementCacheHits = function () {\n    var lastRequests = this.getLastRequests();\n    lastRequests.cacheHits += 1;\n    this.cacheManager.setServerTelemetry(this.telemetryCacheKey, lastRequests);\n    return lastRequests.cacheHits;\n  };\n  /**\r\n   * Get the server telemetry entity from cache or initialize a new one\r\n   */\n  ServerTelemetryManager.prototype.getLastRequests = function () {\n    var initialValue = new ServerTelemetryEntity();\n    var lastRequests = this.cacheManager.getServerTelemetry(this.telemetryCacheKey);\n    return lastRequests || initialValue;\n  };\n  /**\r\n   * Remove server telemetry cache entry\r\n   */\n  ServerTelemetryManager.prototype.clearTelemetryCache = function () {\n    var lastRequests = this.getLastRequests();\n    var numErrorsFlushed = ServerTelemetryManager.maxErrorsToSend(lastRequests);\n    var errorCount = lastRequests.errors.length;\n    if (numErrorsFlushed === errorCount) {\n      // All errors were sent on last request, clear Telemetry cache\n      this.cacheManager.removeItem(this.telemetryCacheKey);\n    } else {\n      // Partial data was flushed to server, construct a new telemetry cache item with errors that were not flushed\n      var serverTelemEntity = new ServerTelemetryEntity();\n      serverTelemEntity.failedRequests = lastRequests.failedRequests.slice(numErrorsFlushed * 2); // failedRequests contains 2 items for each error\n      serverTelemEntity.errors = lastRequests.errors.slice(numErrorsFlushed);\n      this.cacheManager.setServerTelemetry(this.telemetryCacheKey, serverTelemEntity);\n    }\n  };\n  /**\r\n   * Returns the maximum number of errors that can be flushed to the server in the next network request\r\n   * @param serverTelemetryEntity\r\n   */\n  ServerTelemetryManager.maxErrorsToSend = function (serverTelemetryEntity) {\n    var i;\n    var maxErrors = 0;\n    var dataSize = 0;\n    var errorCount = serverTelemetryEntity.errors.length;\n    for (i = 0; i < errorCount; i++) {\n      // failedRequests parameter contains pairs of apiId and correlationId, multiply index by 2 to preserve pairs\n      var apiId = serverTelemetryEntity.failedRequests[2 * i] || Constants.EMPTY_STRING;\n      var correlationId = serverTelemetryEntity.failedRequests[2 * i + 1] || Constants.EMPTY_STRING;\n      var errorCode = serverTelemetryEntity.errors[i] || Constants.EMPTY_STRING;\n      // Count number of characters that would be added to header, each character is 1 byte. Add 3 at the end to account for separators\n      dataSize += apiId.toString().length + correlationId.toString().length + errorCode.length + 3;\n      if (dataSize < SERVER_TELEM_CONSTANTS.MAX_LAST_HEADER_BYTES) {\n        // Adding this entry to the header would still keep header size below the limit\n        maxErrors += 1;\n      } else {\n        break;\n      }\n    }\n    return maxErrors;\n  };\n  /**\r\n   * Get the region discovery fields\r\n   *\r\n   * @returns string\r\n   */\n  ServerTelemetryManager.prototype.getRegionDiscoveryFields = function () {\n    var regionDiscoveryFields = [];\n    regionDiscoveryFields.push(this.regionUsed || Constants.EMPTY_STRING);\n    regionDiscoveryFields.push(this.regionSource || Constants.EMPTY_STRING);\n    regionDiscoveryFields.push(this.regionOutcome || Constants.EMPTY_STRING);\n    return regionDiscoveryFields.join(\",\");\n  };\n  /**\r\n   * Update the region discovery metadata\r\n   *\r\n   * @param regionDiscoveryMetadata\r\n   * @returns void\r\n   */\n  ServerTelemetryManager.prototype.updateRegionDiscoveryMetadata = function (regionDiscoveryMetadata) {\n    this.regionUsed = regionDiscoveryMetadata.region_used;\n    this.regionSource = regionDiscoveryMetadata.region_source;\n    this.regionOutcome = regionDiscoveryMetadata.region_outcome;\n  };\n  /**\r\n   * Set cache outcome\r\n   */\n  ServerTelemetryManager.prototype.setCacheOutcome = function (cacheOutcome) {\n    this.cacheOutcome = cacheOutcome;\n  };\n  return ServerTelemetryManager;\n}();\nexport { ServerTelemetryManager };","map":{"version":3,"names":["ServerTelemetryManager","telemetryRequest","cacheManager","cacheOutcome","CacheOutcome","NO_CACHE_HIT","apiId","correlationId","wrapperSKU","Constants","EMPTY_STRING","wrapperVer","telemetryCacheKey","SERVER_TELEM_CONSTANTS","CACHE_KEY","Separators","CACHE_KEY_SEPARATOR","clientId","prototype","generateCurrentRequestHeaderValue","request","VALUE_SEPARATOR","platformFields","join","regionDiscoveryFields","getRegionDiscoveryFields","requestWithRegionDiscoveryFields","SCHEMA_VERSION","CATEGORY_SEPARATOR","generateLastRequestHeaderValue","lastRequests","getLastRequests","maxErrors","maxErrorsToSend","failedRequests","slice","errors","errorCount","length","overflow","OVERFLOW_TRUE","OVERFLOW_FALSE","cacheHits","cacheFailedRequest","error","MAX_CACHED_ERRORS","shift","push","StringUtils","isEmpty","subError","errorCode","toString","UNKNOWN_ERROR","setServerTelemetry","incrementCacheHits","initialValue","ServerTelemetryEntity","getServerTelemetry","clearTelemetryCache","numErrorsFlushed","removeItem","serverTelemEntity","serverTelemetryEntity","i","dataSize","MAX_LAST_HEADER_BYTES","regionUsed","regionSource","regionOutcome","updateRegionDiscoveryMetadata","regionDiscoveryMetadata","region_used","region_source","region_outcome","setCacheOutcome"],"sources":["../../../src/telemetry/server/ServerTelemetryManager.ts"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { SERVER_TELEM_CONSTANTS, Separators, CacheOutcome, Constants, RegionDiscoverySources, RegionDiscoveryOutcomes } from \"../../utils/Constants\";\nimport { CacheManager } from \"../../cache/CacheManager\";\nimport { AuthError } from \"../../error/AuthError\";\nimport { ServerTelemetryRequest } from \"./ServerTelemetryRequest\";\nimport { ServerTelemetryEntity } from \"../../cache/entities/ServerTelemetryEntity\";\nimport { StringUtils } from \"../../utils/StringUtils\";\nimport { RegionDiscoveryMetadata } from \"../../authority/RegionDiscoveryMetadata\";\n\nexport class ServerTelemetryManager {\n    private cacheManager: CacheManager;\n    private apiId: number;\n    private correlationId: string;\n    private telemetryCacheKey: string;\n    private wrapperSKU: String;\n    private wrapperVer: String;\n    private regionUsed: string | undefined;\n    private regionSource: RegionDiscoverySources | undefined;\n    private regionOutcome: RegionDiscoveryOutcomes | undefined;\n    private cacheOutcome: CacheOutcome = CacheOutcome.NO_CACHE_HIT;\n\n    constructor(telemetryRequest: ServerTelemetryRequest, cacheManager: CacheManager) {\n        this.cacheManager = cacheManager;\n        this.apiId = telemetryRequest.apiId;\n        this.correlationId = telemetryRequest.correlationId;\n        this.wrapperSKU = telemetryRequest.wrapperSKU || Constants.EMPTY_STRING;\n        this.wrapperVer = telemetryRequest.wrapperVer || Constants.EMPTY_STRING;\n\n        this.telemetryCacheKey = SERVER_TELEM_CONSTANTS.CACHE_KEY + Separators.CACHE_KEY_SEPARATOR + telemetryRequest.clientId;\n    }\n\n    /**\n     * API to add MSER Telemetry to request\n     */\n    generateCurrentRequestHeaderValue(): string {\n        const request = `${this.apiId}${SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR}${this.cacheOutcome}`;\n        const platformFields = [this.wrapperSKU, this.wrapperVer].join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n        const regionDiscoveryFields = this.getRegionDiscoveryFields();\n        const requestWithRegionDiscoveryFields = [request, regionDiscoveryFields].join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n\n        return [SERVER_TELEM_CONSTANTS.SCHEMA_VERSION, requestWithRegionDiscoveryFields, platformFields].join(SERVER_TELEM_CONSTANTS.CATEGORY_SEPARATOR);\n    }\n\n    /**\n     * API to add MSER Telemetry for the last failed request\n     */\n    generateLastRequestHeaderValue(): string {\n        const lastRequests = this.getLastRequests();\n\n        const maxErrors = ServerTelemetryManager.maxErrorsToSend(lastRequests);\n        const failedRequests = lastRequests.failedRequests.slice(0, 2*maxErrors).join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n        const errors = lastRequests.errors.slice(0, maxErrors).join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n        const errorCount = lastRequests.errors.length;\n\n        // Indicate whether this header contains all data or partial data\n        const overflow = maxErrors < errorCount ? SERVER_TELEM_CONSTANTS.OVERFLOW_TRUE : SERVER_TELEM_CONSTANTS.OVERFLOW_FALSE;\n        const platformFields = [errorCount, overflow].join(SERVER_TELEM_CONSTANTS.VALUE_SEPARATOR);\n\n        return [SERVER_TELEM_CONSTANTS.SCHEMA_VERSION, lastRequests.cacheHits, failedRequests, errors, platformFields].join(SERVER_TELEM_CONSTANTS.CATEGORY_SEPARATOR);\n    }\n\n    /**\n     * API to cache token failures for MSER data capture\n     * @param error\n     */\n    cacheFailedRequest(error: AuthError): void {\n        const lastRequests = this.getLastRequests();\n        if (lastRequests.errors.length >= SERVER_TELEM_CONSTANTS.MAX_CACHED_ERRORS) {\n            // Remove a cached error to make room, first in first out\n            lastRequests.failedRequests.shift(); // apiId\n            lastRequests.failedRequests.shift(); // correlationId\n            lastRequests.errors.shift();\n        }\n        \n        lastRequests.failedRequests.push(this.apiId, this.correlationId);\n\n        if (!StringUtils.isEmpty(error.subError)) {\n            lastRequests.errors.push(error.subError);\n        } else if (!StringUtils.isEmpty(error.errorCode)) {\n            lastRequests.errors.push(error.errorCode);\n        } else if (!!error && error.toString()) {\n            lastRequests.errors.push(error.toString());\n        } else {\n            lastRequests.errors.push(SERVER_TELEM_CONSTANTS.UNKNOWN_ERROR);\n        }\n\n        this.cacheManager.setServerTelemetry(this.telemetryCacheKey, lastRequests);\n\n        return;\n    }\n\n    /**\n     * Update server telemetry cache entry by incrementing cache hit counter\n     */\n    incrementCacheHits(): number {\n        const lastRequests = this.getLastRequests();\n        lastRequests.cacheHits += 1;\n\n        this.cacheManager.setServerTelemetry(this.telemetryCacheKey, lastRequests);\n        return lastRequests.cacheHits;\n    }\n\n    /**\n     * Get the server telemetry entity from cache or initialize a new one\n     */\n    getLastRequests(): ServerTelemetryEntity {\n        const initialValue: ServerTelemetryEntity = new ServerTelemetryEntity();\n        const lastRequests = this.cacheManager.getServerTelemetry(this.telemetryCacheKey) as ServerTelemetryEntity;\n\n        return lastRequests || initialValue;\n    }\n\n    /**\n     * Remove server telemetry cache entry\n     */\n    clearTelemetryCache(): void {\n        const lastRequests = this.getLastRequests();\n        const numErrorsFlushed = ServerTelemetryManager.maxErrorsToSend(lastRequests);\n        const errorCount = lastRequests.errors.length;\n        if (numErrorsFlushed === errorCount) {\n            // All errors were sent on last request, clear Telemetry cache\n            this.cacheManager.removeItem(this.telemetryCacheKey);\n        } else {\n            // Partial data was flushed to server, construct a new telemetry cache item with errors that were not flushed\n            const serverTelemEntity = new ServerTelemetryEntity();\n            serverTelemEntity.failedRequests = lastRequests.failedRequests.slice(numErrorsFlushed*2); // failedRequests contains 2 items for each error\n            serverTelemEntity.errors = lastRequests.errors.slice(numErrorsFlushed);\n\n            this.cacheManager.setServerTelemetry(this.telemetryCacheKey, serverTelemEntity);\n        }\n    }\n\n    /**\n     * Returns the maximum number of errors that can be flushed to the server in the next network request\n     * @param serverTelemetryEntity\n     */\n    static maxErrorsToSend(serverTelemetryEntity: ServerTelemetryEntity): number {\n        let i;\n        let maxErrors = 0;\n        let dataSize = 0;\n        const errorCount = serverTelemetryEntity.errors.length;\n        for (i = 0; i < errorCount; i++) {\n            // failedRequests parameter contains pairs of apiId and correlationId, multiply index by 2 to preserve pairs\n            const apiId = serverTelemetryEntity.failedRequests[2*i] || Constants.EMPTY_STRING;\n            const correlationId = serverTelemetryEntity.failedRequests[2*i + 1] || Constants.EMPTY_STRING;\n            const errorCode = serverTelemetryEntity.errors[i] || Constants.EMPTY_STRING;\n\n            // Count number of characters that would be added to header, each character is 1 byte. Add 3 at the end to account for separators\n            dataSize += apiId.toString().length + correlationId.toString().length + errorCode.length + 3;\n\n            if (dataSize < SERVER_TELEM_CONSTANTS.MAX_LAST_HEADER_BYTES) {\n                // Adding this entry to the header would still keep header size below the limit\n                maxErrors += 1;\n            } else {\n                break;\n            }\n        }\n\n        return maxErrors;\n    }\n\n    /**\n     * Get the region discovery fields\n     * \n     * @returns string\n     */\n    getRegionDiscoveryFields(): string {\n        const regionDiscoveryFields: string[] = [];\n\n        regionDiscoveryFields.push(this.regionUsed || Constants.EMPTY_STRING);\n        regionDiscoveryFields.push(this.regionSource || Constants.EMPTY_STRING);\n        regionDiscoveryFields.push(this.regionOutcome || Constants.EMPTY_STRING);\n\n        return regionDiscoveryFields.join(\",\");\n    }\n\n    /**\n     * Update the region discovery metadata\n     * \n     * @param regionDiscoveryMetadata\n     * @returns void\n     */\n    updateRegionDiscoveryMetadata(regionDiscoveryMetadata: RegionDiscoveryMetadata): void {\n        this.regionUsed = regionDiscoveryMetadata.region_used;\n        this.regionSource = regionDiscoveryMetadata.region_source;\n        this.regionOutcome = regionDiscoveryMetadata.region_outcome;\n    }\n\n    /**\n     * Set cache outcome \n     */\n    setCacheOutcome(cacheOutcome: CacheOutcome): void {\n        this.cacheOutcome = cacheOutcome;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}