{"ast":null,"code":"/*\n * grunt-mock-s3\n * https://github.com/MathieuLoutre/grunt-mock-s3\n *\n * Copyright (c) 2013 Mathieu Triay\n * Licensed under the MIT license.\n */\n\n'use strict';\n\nvar _ = require('underscore');\nvar fs = require('fs-extra');\nvar crypto = require('crypto');\nvar path = require('path');\nvar Buffer = require('buffer').Buffer;\nvar Promise = require('bluebird');\nvar path = require('path');\nvar config = {};\n\n// Gathered from http://stackoverflow.com/questions/5827612/node-js-fs-readdir-recursive-directory-search\nfunction walk(dir) {\n  var results = [];\n  var list = fs.readdirSync(dir);\n  list.forEach(function (file) {\n    file = dir + '/' + file;\n    var stat = fs.statSync(file);\n    if (stat && stat.isDirectory()) {\n      results = results.concat(walk(file));\n    } else {\n      results.push(file);\n    }\n  });\n  return results;\n}\n\n/** Add basePath to selected keys */\nfunction applyBasePath(search) {\n  if (_.isUndefined(config.basePath)) {\n    return search;\n  }\n  var modifyKeys = ['Bucket', 'CopySource'];\n  var ret = _.mapObject(search, function (value, key) {\n    if (_.indexOf(modifyKeys, key) === -1) {\n      return value;\n    } else {\n      if (config.basePath == null || value == null) {\n        return;\n      }\n      return path.join(config.basePath, value);\n    }\n  });\n  return ret;\n}\n\n/** FakeStream object for mocking S3 streams */\nfunction FakeStream(search) {\n  this.src = search.Bucket + '/' + search.Key;\n}\nFakeStream.prototype.createReadStream = function () {\n  return fs.createReadStream(this.src);\n};\n\n/**\n * Decorate a method to enable calling `.promise()` on the returned value to get a Promise, when the method\n * is initially called without a callback.\n * @decorator\n * @private\n */\nfunction createPromisable(wrapped) {\n  return function () {\n    var self = this;\n    var promisified = Promise.promisify(wrapped, {\n      context: self\n    });\n    var args = [].slice.call(arguments);\n    var callback = null;\n    var lastArgIndex = Math.min(args.length - 1, wrapped.length);\n    if (args.length >= 1) {\n      var lastArg = args[lastArgIndex];\n      if (_.isFunction(lastArg)) {\n        callback = lastArg;\n      }\n    }\n    if (!_.isFunction(callback)) {\n      return {\n        createReadStream: function createReadStream() {\n          this.send();\n          if (this._returned instanceof FakeStream) {\n            return this._returned.createReadStream();\n          }\n        },\n        promise: function promise() {\n          return promisified.apply(self, args);\n        },\n        send: function send(cb) {\n          args.push(cb);\n          this._returned = wrapped.apply(self, args);\n        }\n      };\n    } else {\n      wrapped.apply(self, args);\n    }\n  };\n}\n\n/** Mocks key pieces of the amazon s3 sdk */\nfunction S3Mock(options) {\n  if (!_.isUndefined(options) && !_.isUndefined(options.params)) {\n    this.defaultOptions = _.extend({}, applyBasePath(options.params));\n  }\n  this.config = {\n    update: function update() {}\n  };\n}\nS3Mock.prototype = {\n  objectMetadataDictionary: [],\n  objectTaggingDictionary: [],\n  listObjectsV2: function listObjectsV2(searchV2, callback) {\n    var searchV1 = _(searchV2).clone();\n    // Marker in V1 is StartAfter in V2\n    // ContinuationToken trumps marker on subsequent requests.\n    searchV1.Marker = searchV2.ContinuationToken || searchV2.StartAfter;\n    this.listObjects(searchV1, function (err, resultV1) {\n      var resultV2 = _(resultV1).clone();\n      // Rewrite NextMarker to NextContinuationToken\n      resultV2.NextContinuationToken = resultV1.NextMarker;\n      // Remember original ContinuationToken and StartAfter\n      resultV2.ContinuationToken = searchV2.ContinuationToken;\n      resultV2.StartAfter = searchV2.StartAfter;\n      callback(err, resultV2);\n    });\n  },\n  listObjects: function listObjects(search, callback) {\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    var files = walk(search.Bucket);\n    var filteredFiles = _.filter(files, function (file) {\n      return !search.Prefix || file.replace(search.Bucket + '/', '').indexOf(search.Prefix) === 0;\n    });\n    var start = 0;\n    var truncated = false;\n    if (search.Marker) {\n      var isPartial;\n      var markerFile = _(filteredFiles).find(function (file) {\n        var marker = search.Bucket + '/' + search.Marker;\n        if (file.indexOf(marker) === 0) {\n          isPartial = file.length !== marker.length;\n          return true;\n        }\n      });\n      var startFile;\n      if (isPartial) {\n        startFile = filteredFiles[filteredFiles.indexOf(markerFile)];\n      } else {\n        startFile = filteredFiles[filteredFiles.indexOf(markerFile) + 1];\n      }\n      start = filteredFiles.indexOf(startFile);\n    }\n    if (start === -1) {\n      filteredFiles = [];\n    } else {\n      filteredFiles = _.rest(filteredFiles, start);\n    }\n    if (filteredFiles.length > Math.min(1000, search.MaxKeys || 1000)) {\n      truncated = true;\n      filteredFiles = filteredFiles.slice(0, Math.min(1000, search.MaxKeys || 1000));\n    }\n    var result = {\n      Contents: _.map(filteredFiles, function (path) {\n        var stat = fs.statSync(path);\n        return {\n          Key: path.replace(search.Bucket + '/', ''),\n          ETag: '\"' + crypto.createHash('md5').update(fs.readFileSync(path)).digest('hex') + '\"',\n          LastModified: stat.mtime,\n          Size: stat.size\n        };\n      }),\n      CommonPrefixes: _.reduce(filteredFiles, function (prefixes, path) {\n        var prefix = path.replace(search.Bucket + '/', '').split('/').slice(0, -1).join('/').concat('/');\n        return prefixes.indexOf(prefix) === -1 ? prefixes.concat([prefix]) : prefixes;\n      }, []).map(function (prefix) {\n        return {\n          Prefix: prefix\n        };\n      }),\n      IsTruncated: truncated\n    };\n    if (search.Marker) {\n      result.Marker = search.Marker;\n    }\n    if (truncated && search.Delimiter) {\n      result.NextMarker = _.last(result.Contents).Key;\n    }\n    callback(null, result);\n  },\n  deleteObjects: function deleteObjects(search, callback) {\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    var deleted = [];\n    var errors = [];\n    _.each(search.Delete.Objects, function (file) {\n      if (fs.existsSync(search.Bucket + '/' + file.Key)) {\n        deleted.push(file);\n        fs.unlinkSync(search.Bucket + '/' + file.Key);\n      } else {\n        errors.push(file);\n      }\n    });\n    if (errors.length > 0) {\n      callback('Error deleting objects', {\n        Errors: errors,\n        Deleted: deleted\n      });\n    } else {\n      callback(null, {\n        Deleted: deleted\n      });\n    }\n  },\n  deleteObject: function deleteObject(search, callback) {\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    if (fs.existsSync(search.Bucket + '/' + search.Key)) {\n      fs.unlinkSync(search.Bucket + '/' + search.Key);\n      callback(null, true);\n    } else {\n      callback(null, {});\n    }\n  },\n  headObject: function headObject(search, callback) {\n    var self = this;\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    if (!callback) {\n      return new FakeStream(search);\n    } else {\n      fs.readFile(search.Bucket + '/' + search.Key, function (err, data) {\n        if (!err) {\n          var props = {\n            Key: search.Key,\n            ETag: '\"' + crypto.createHash('md5').update(data).digest('hex') + '\"',\n            ContentLength: data.length\n          };\n          if (self.objectMetadataDictionary[search.Key]) {\n            props.Metadata = self.objectMetadataDictionary[search.Key];\n          }\n          callback(null, props);\n        } else {\n          if (err.code === 'ENOENT') {\n            err.statusCode = 404;\n          }\n          callback(err, search);\n        }\n      });\n    }\n  },\n  getObject: function getObject(search, callback) {\n    var self = this;\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    if (!callback) {\n      return new FakeStream(search);\n    } else {\n      var path = search.Bucket + '/' + search.Key;\n      fs.readFile(path, function (err, data) {\n        if (!err) {\n          var stat = fs.statSync(path);\n          var props = {\n            Key: search.Key,\n            ETag: '\"' + crypto.createHash('md5').update(data).digest('hex') + '\"',\n            Body: data,\n            LastModified: stat.mtime,\n            ContentLength: data.length\n          };\n          if (self.objectMetadataDictionary[search.Key]) {\n            props.Metadata = self.objectMetadataDictionary[search.Key];\n          }\n          callback(null, props);\n        } else {\n          if (err.code === 'ENOENT') {\n            return callback({\n              cfId: undefined,\n              code: 'NoSuchKey',\n              message: 'The specified key does not exist.',\n              name: 'NoSuchKey',\n              region: null,\n              statusCode: 404\n            }, search);\n          }\n          callback(err, search);\n        }\n      });\n    }\n  },\n  copyObject: function copyObject(search, callback) {\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    fs.mkdirsSync(path.dirname(search.Bucket + '/' + search.Key));\n    fs.copy(decodeURIComponent(search.CopySource), search.Bucket + '/' + search.Key, function (err, data) {\n      callback(err, search);\n    });\n  },\n  createBucket: function createBucket(params, callback) {\n    var err = null;\n\n    // param prop tests - these need to be done here to avoid issues with defaulted values\n    if (typeof params === 'object' && params !== null) {\n      // null is an object, at least in older V8's\n      // Bucket - required, String\n      if (typeof params.Bucket !== 'string' || params.Bucket.length <= 0) {\n        // NOTE: This *will not* match the error provided by the AWS SDK - but that's chasing a moving target\n        err = new Error(\"Mock-AWS-S3: Argument 'params' must contain a 'Bucket' (String) property\");\n      }\n\n      // Should we check the remaining props of the params Object? (probably)\n    } else {\n      err = new Error(\"Mock-AWS-S3: Argument 'params' must be an Object\");\n    }\n\n    // Note: this.defaultOptions is an object which was passed in to the constructor\n    var opts = _.extend({}, this.defaultOptions, applyBasePath(params));\n\n    // If the params object is well-formed...\n    if (err === null) {\n      // We'll assume that if basePath is set, it's correctly set (i.e. data type etc.) and if not...\n      // we'll default to the local dir (which seems to be the existing behaviour - in e.g. putObject)\n      // It would be nicer if there were a strongly defined default\n      var bucketPath = opts.basePath || '';\n      bucketPath += opts.Bucket;\n      fs.mkdirs(bucketPath, function (err) {\n        return callback(err);\n      });\n    } else {\n      // ...if the params object is not well-formed, fail fast\n      return callback(err);\n    }\n  },\n  /**\n   * Deletes a bucket. Behaviour as createBucket\n   * @param params {Bucket: bucketName}. Name of bucket to delete\n   * @param callback\n   * @returns void\n   */\n  deleteBucket: function deleteBucket(params, callback) {\n    var err = null;\n    if (typeof params === 'object' && params !== null) {\n      if (typeof params.Bucket !== 'string' || params.Bucket.length <= 0) {\n        err = new Error(\"Mock-AWS-S3: Argument 'params' must contain a 'Bucket' (String) property\");\n      }\n    } else {\n      err = new Error(\"Mock-AWS-S3: Argument 'params' must be an Object\");\n    }\n    var opts = _.extend({}, this.defaultOptions, applyBasePath(params));\n    if (err !== null) {\n      callback(err);\n    }\n    var bucketPath = opts.basePath || '';\n    bucketPath += opts.Bucket;\n    fs.remove(bucketPath, function (err) {\n      return callback(err);\n    });\n  },\n  putObject: function putObject(search, callback) {\n    search = _.extend({}, this.defaultOptions, applyBasePath(search));\n    if (search.Metadata) {\n      this.objectMetadataDictionary[search.Key] = search.Metadata;\n    }\n    if (typeof search.Tagging === 'string') {\n      // URL query parameter encoded\n      var tags = {};\n      var tagSet = [];\n\n      // quick'n'dirty parsing into an object (does not support hashes or arrays)\n      search.Tagging.split('&').forEach(function (part) {\n        var item = part.split('=');\n        tags[decodeURIComponent(item[0])] = decodeURIComponent(item[1]);\n      });\n\n      // expand into tagset\n      Object.keys(tags).forEach(function (key) {\n        tagSet.push({\n          Key: key,\n          Value: tags[key]\n        });\n      });\n      this.objectTaggingDictionary[search.Key] = tagSet;\n    }\n    var dest = search.Bucket + '/' + search.Key;\n    var sendCallback = null;\n    var done = function done() {\n      if (typeof sendCallback === 'function') {\n        sendCallback.apply(this, arguments);\n      }\n      if (typeof callback === 'function') {\n        callback.apply(this, arguments);\n      }\n    };\n    if (typeof search.Body === 'string') {\n      search.Body = Buffer.from(search.Body);\n    }\n    if (search.Body instanceof Buffer) {\n      fs.createFileSync(dest);\n      fs.writeFile(dest, search.Body, function (err) {\n        done(err, {\n          Location: dest,\n          Key: search.Key,\n          Bucket: search.Bucket\n        });\n      });\n    } else {\n      fs.mkdirsSync(path.dirname(dest));\n      var stream = fs.createWriteStream(dest);\n      stream.on('finish', function () {\n        done(null, true);\n      });\n      search.Body.on('error', function (err) {\n        done(err);\n      });\n      stream.on('error', function (err) {\n        done(err);\n      });\n      search.Body.pipe(stream);\n    }\n    return {\n      send: function send(cb) {\n        sendCallback = cb;\n      }\n    };\n  },\n  getObjectTagging: function getObjectTagging(search, callback) {\n    var self = this;\n    this.headObject(search, function (err, props) {\n      if (err) {\n        return callback(err);\n      } else {\n        return callback(null, {\n          VersionId: '1',\n          TagSet: self.objectTaggingDictionary[search.Key] || []\n        });\n      }\n    });\n  },\n  putObjectTagging: function putObjectTagging(search, callback) {\n    var self = this;\n    if (!search.Tagging || !search.Tagging.TagSet) {\n      return callback(new Error('Tagging.TagSet required'));\n    }\n    this.headObject(search, function (err, props) {\n      if (err) {\n        return callback(err);\n      } else {\n        self.objectTaggingDictionary[search.Key] = search.Tagging.TagSet;\n        return callback(null, {\n          VersionId: '1'\n        });\n      }\n    });\n  },\n  upload: function upload(search, options, callback) {\n    if (typeof options === 'function' && callback === undefined) {\n      callback = options;\n      options = null;\n    }\n    if (options && options.tags) {\n      if (!Array.isArray(options.tags)) {\n        return callback(new Error('Tags must be specified as an array; ' + typeof options.tags + ' provided'));\n      }\n    }\n    return this.putObject(search, function (err, data) {\n      if (options && options.tags) {\n        // https://github.com/aws/aws-sdk-js/pull/1425\n        return this.putObjectTagging({\n          Bucket: search.Bucket,\n          Key: search.Key,\n          Tagging: {\n            TagSet: options.tags\n          }\n        }, function (err) {\n          if (err) {\n            return callback(err);\n          }\n          return callback(null, data);\n        });\n      }\n      return callback(err, data);\n    }.bind(this));\n  },\n  getSignedUrl: function getSignedUrl(operation, params, callback) {\n    var url = 'https://s3.us-east-2.amazonaws.com/' + params.Bucket + '/' + params.Key + '?X-Amz-Date=20170720T182534Z&X-Amz-SignedHeaders=host' + '&X-Amz-Credential=ASIAIYLQNVRRFNZOCFBA%2F20170720%2' + 'Fus-east-2%2Fs3%2Faws4_request&X-Amz-Algorithm=AWS4-HMAC-SHA256&X' + '-Amz-Expires=604800&X-Amz-Security-Token=FQoDYXdzEJP%2F%2F%2F%2F%2' + 'F%2F%2F%2F%2F%2FwEaDOLWx95j90zPxGh7WSLdAVnoYoKC4gjrrR1xbokFWRRwutm' + 'uAmOxaIVcQqOy%2Fqxy%2FXQt3Iz%2FohuEEmI7%2FHPzShy%2BfgQtvfUeDaojrAx' + '5q8fG9P1KuIfcedfkiU%2BCxpM2foyCGlXzoZuNlcF8ohm%2BaM3wh4%2BxQ%2FpSh' + 'Ll18cKiKEiw0QF1UQGj%2FsiEqzoM81vOSUVWL9SpTTkVq8EQHY1chYKBkBWt7eIQc' + 'xjTI2dQeYOohlrbnZ5Y1%2F1cxPgrbk6PkNFO3whAoliSjyRC8e4TSjIY2j3V6d9fU' + 'y4%2Fp6nLZIf9wuERL7xW9PjE6eZbKOHnw8sF&X-Amz-Signature=a14b3065ab82' + '2105e8d7892eb5dcc455ddd603c61e47520774a7289178af9ecc';\n    switch (operation) {\n      case 'getObject':\n        this.headObject(params, function (err, props) {\n          if (err) {\n            err.statusCode = 404;\n          }\n          if (callback) {\n            if (err) {\n              callback(err, null);\n            } else {\n              callback(null, url);\n            }\n          } else {\n            if (err) {\n              throw new Error(err);\n            }\n            return url;\n          }\n        });\n        break;\n      case 'putObject':\n        if (!params.Bucket || !params.Key) {\n          throw new Error({\n            statusCode: 404\n          });\n        }\n        return url;\n      default:\n    }\n  }\n};\n_.forEach(S3Mock.prototype, function (value, key, obj) {\n  if (_.isFunction(value)) {\n    obj[key] = createPromisable(value);\n  }\n});\nexports.config = config;\nexports.S3 = function (options) {\n  return new S3Mock(options);\n};","map":{"version":3,"names":["_","require","fs","crypto","path","Buffer","Promise","config","walk","dir","results","list","readdirSync","forEach","file","stat","statSync","isDirectory","concat","push","applyBasePath","search","isUndefined","basePath","modifyKeys","ret","mapObject","value","key","indexOf","join","FakeStream","src","Bucket","Key","prototype","createReadStream","createPromisable","wrapped","self","promisified","promisify","context","args","slice","call","arguments","callback","lastArgIndex","Math","min","length","lastArg","isFunction","send","_returned","promise","apply","cb","S3Mock","options","params","defaultOptions","extend","update","objectMetadataDictionary","objectTaggingDictionary","listObjectsV2","searchV2","searchV1","clone","Marker","ContinuationToken","StartAfter","listObjects","err","resultV1","resultV2","NextContinuationToken","NextMarker","files","filteredFiles","filter","Prefix","replace","start","truncated","isPartial","markerFile","find","marker","startFile","rest","MaxKeys","result","Contents","map","ETag","createHash","readFileSync","digest","LastModified","mtime","Size","size","CommonPrefixes","reduce","prefixes","prefix","split","IsTruncated","Delimiter","last","deleteObjects","deleted","errors","each","Delete","Objects","existsSync","unlinkSync","Errors","Deleted","deleteObject","headObject","readFile","data","props","ContentLength","Metadata","code","statusCode","getObject","Body","cfId","undefined","message","name","region","copyObject","mkdirsSync","dirname","copy","decodeURIComponent","CopySource","createBucket","Error","opts","bucketPath","mkdirs","deleteBucket","remove","putObject","Tagging","tags","tagSet","part","item","Object","keys","Value","dest","sendCallback","done","from","createFileSync","writeFile","Location","stream","createWriteStream","on","pipe","getObjectTagging","VersionId","TagSet","putObjectTagging","upload","Array","isArray","bind","getSignedUrl","operation","url","obj","exports","S3"],"sources":["/Users/aribraun/Desktop/db-import/node_modules/mock-aws-s3/lib/mock.js"],"sourcesContent":["/*\n * grunt-mock-s3\n * https://github.com/MathieuLoutre/grunt-mock-s3\n *\n * Copyright (c) 2013 Mathieu Triay\n * Licensed under the MIT license.\n */\n\n'use strict'\n\nvar _ = require('underscore')\nvar fs = require('fs-extra')\nvar crypto = require('crypto')\nvar path = require('path')\nvar Buffer = require('buffer').Buffer\nvar Promise = require('bluebird')\nvar path = require('path')\nvar config = {}\n\n// Gathered from http://stackoverflow.com/questions/5827612/node-js-fs-readdir-recursive-directory-search\nfunction walk (dir) {\n\tvar results = []\n\tvar list = fs.readdirSync(dir)\n\n\tlist.forEach(function (file) {\n\t\tfile = dir + '/' + file\n\t\tvar stat = fs.statSync(file)\n\n\t\tif (stat && stat.isDirectory()) {\n\t\t\tresults = results.concat(walk(file))\n\t\t}\n\t\telse {\n\t\t\tresults.push(file)\n\t\t}\n\t})\n\n\treturn results\n}\n\n/** Add basePath to selected keys */\nfunction applyBasePath (search) {\n\tif (_.isUndefined(config.basePath)) {\n\t\treturn search\n\t}\n\n\tvar modifyKeys = ['Bucket', 'CopySource']\n\n\tvar ret = _.mapObject(search, function (value, key) {\n\t\tif (_.indexOf(modifyKeys, key) === -1) {\n\t\t\treturn value\n\t\t}\n\t\telse {\n\t\t\tif (config.basePath == null || value == null) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn path.join(config.basePath, value)\n\t\t}\n\t})\n\n\treturn ret\n}\n\n/** FakeStream object for mocking S3 streams */\nfunction FakeStream (search) {\n\tthis.src = search.Bucket + '/' + search.Key\n}\n\nFakeStream.prototype.createReadStream = function () {\n\treturn fs.createReadStream(this.src)\n}\n\n/**\n * Decorate a method to enable calling `.promise()` on the returned value to get a Promise, when the method\n * is initially called without a callback.\n * @decorator\n * @private\n */\nfunction createPromisable (wrapped) {\n\treturn function () {\n\t\tvar self = this\n\t\tvar promisified = Promise.promisify(wrapped, { context: self })\n\t\tvar args = [].slice.call(arguments)\n\t\tvar callback = null\n\t\tvar lastArgIndex = Math.min(args.length - 1, wrapped.length)\n\n\t\tif (args.length >= 1) {\n\t\t\tvar lastArg = args[lastArgIndex]\n\n\t\t\tif (_.isFunction(lastArg)) {\n\t\t\t\tcallback = lastArg\n\t\t\t}\n\t\t}\n\n\t\tif (!_.isFunction(callback)) {\n\t\t\treturn {\n\t\t\t\tcreateReadStream: function () {\n\t\t\t\t\tthis.send()\n\n\t\t\t\t\tif (this._returned instanceof FakeStream) {\n\t\t\t\t\t\treturn this._returned.createReadStream()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpromise: function () {\n\t\t\t\t\treturn promisified.apply(self, args)\n\t\t\t\t},\n\t\t\t\tsend: function (cb) {\n\t\t\t\t\targs.push(cb)\n\t\t\t\t\tthis._returned = wrapped.apply(self, args)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\twrapped.apply(self, args)\n\t\t}\n\t}\n}\n\n/** Mocks key pieces of the amazon s3 sdk */\nfunction S3Mock (options) {\n\tif (!_.isUndefined(options) && !_.isUndefined(options.params)) {\n\t\tthis.defaultOptions = _.extend({}, applyBasePath(options.params))\n\t}\n\n\tthis.config = {\n\t\tupdate: function () {}\n\t}\n}\n\nS3Mock.prototype = {\n\tobjectMetadataDictionary: [],\n\tobjectTaggingDictionary: [],\n\n\tlistObjectsV2: function (searchV2, callback) {\n\t\tvar searchV1 = _(searchV2).clone()\n\t\t// Marker in V1 is StartAfter in V2\n\t\t// ContinuationToken trumps marker on subsequent requests.\n\t\tsearchV1.Marker = searchV2.ContinuationToken || searchV2.StartAfter\n\n\t\tthis.listObjects(searchV1, function (err, resultV1) {\n\t\t\tvar resultV2 = _(resultV1).clone()\n\t\t\t// Rewrite NextMarker to NextContinuationToken\n\t\t\tresultV2.NextContinuationToken = resultV1.NextMarker\n\t\t\t// Remember original ContinuationToken and StartAfter\n\t\t\tresultV2.ContinuationToken = searchV2.ContinuationToken\n\t\t\tresultV2.StartAfter = searchV2.StartAfter\n\t\t\tcallback(err, resultV2)\n\t\t})\n\t},\n\n\tlistObjects: function (search, callback) {\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\t\tvar files = walk(search.Bucket)\n\n\t\tvar filteredFiles = _.filter(files, function (file) {\n\t\t\treturn !search.Prefix || file.replace(search.Bucket + '/', '').indexOf(search.Prefix) === 0\n\t\t})\n\t\tvar start = 0\n\t\tvar truncated = false\n\n\t\tif (search.Marker) {\n\t\t\tvar isPartial\n\t\t\tvar markerFile = _(filteredFiles).find(function (file) {\n\t\t\t\tvar marker = search.Bucket + '/' + search.Marker\n\n\t\t\t\tif (file.indexOf(marker) === 0) {\n\t\t\t\t\tisPartial = file.length !== marker.length\n\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tvar startFile\n\n\t\t\tif (isPartial) {\n\t\t\t\tstartFile = filteredFiles[filteredFiles.indexOf(markerFile)]\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstartFile = filteredFiles[filteredFiles.indexOf(markerFile) + 1]\n\t\t\t}\n\n\t\t\tstart = filteredFiles.indexOf(startFile)\n\t\t}\n\n\t\tif (start === -1) {\n\t\t\tfilteredFiles = []\n\t\t}\n\t\telse {\n\t\t\tfilteredFiles = _.rest(filteredFiles, start)\n\t\t}\n\n\t\tif (filteredFiles.length > Math.min(1000, search.MaxKeys || 1000)) {\n\t\t\ttruncated = true\n\t\t\tfilteredFiles = filteredFiles.slice(0, Math.min(1000, search.MaxKeys || 1000))\n\t\t}\n\n\t\tvar result = {\n\t\t\tContents: _.map(filteredFiles, function (path) {\n\t\t\t\tvar stat = fs.statSync(path)\n\n\t\t\t\treturn {\n\t\t\t\t\tKey: path.replace(search.Bucket + '/', ''),\n\t\t\t\t\tETag: '\"' + crypto.createHash('md5').update(fs.readFileSync(path)).digest('hex') + '\"',\n\t\t\t\t\tLastModified: stat.mtime,\n\t\t\t\t\tSize: stat.size\n\t\t\t\t}\n\t\t\t}),\n\t\t\tCommonPrefixes: _.reduce(filteredFiles, function (prefixes, path) {\n\t\t\t\tvar prefix = path\n\t\t\t\t\t.replace(search.Bucket + '/', '')\n\t\t\t\t\t.split('/')\n\t\t\t\t\t.slice(0, -1)\n\t\t\t\t\t.join('/')\n\t\t\t\t\t.concat('/')\n\n\t\t\t\treturn prefixes.indexOf(prefix) === -1 ? prefixes.concat([prefix]) : prefixes\n\t\t\t}, []).map(function (prefix) {\n\t\t\t\treturn {\n\t\t\t\t\tPrefix: prefix\n\t\t\t\t}\n\t\t\t}),\n\t\t\tIsTruncated: truncated\n\t\t}\n\n\t\tif (search.Marker) {\n\t\t\tresult.Marker = search.Marker\n\t\t}\n\n\t\tif (truncated && search.Delimiter) {\n\t\t\tresult.NextMarker = _.last(result.Contents).Key\n\t\t}\n\n\t\tcallback(null, result)\n\t},\n\n\tdeleteObjects: function (search, callback) {\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\n\t\tvar deleted = []\n\t\tvar errors = []\n\n\t\t_.each(search.Delete.Objects, function (file) {\n\t\t\tif (fs.existsSync(search.Bucket + '/' + file.Key)) {\n\t\t\t\tdeleted.push(file)\n\t\t\t\tfs.unlinkSync(search.Bucket + '/' + file.Key)\n\t\t\t}\n\t\t\telse {\n\t\t\t\terrors.push(file)\n\t\t\t}\n\t\t})\n\n\t\tif (errors.length > 0) {\n\t\t\tcallback('Error deleting objects', { Errors: errors, Deleted: deleted })\n\t\t}\n\t\telse {\n\t\t\tcallback(null, { Deleted: deleted })\n\t\t}\n\t},\n\n\tdeleteObject: function (search, callback) {\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\n\t\tif (fs.existsSync(search.Bucket + '/' + search.Key)) {\n\t\t\tfs.unlinkSync(search.Bucket + '/' + search.Key)\n\t\t\tcallback(null, true)\n\t\t}\n\t\telse {\n\t\t\tcallback(null, {})\n\t\t}\n\t},\n\n\theadObject: function (search, callback) {\n\t\tvar self = this\n\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\n\t\tif (!callback) {\n\t\t\treturn new FakeStream(search)\n\t\t}\n\t\telse {\n\t\t\tfs.readFile(search.Bucket + '/' + search.Key, function (err, data) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tvar props = {\n\t\t\t\t\t\tKey: search.Key,\n\t\t\t\t\t\tETag: '\"' + crypto.createHash('md5').update(data).digest('hex') + '\"',\n\t\t\t\t\t\tContentLength: data.length\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.objectMetadataDictionary[search.Key]) {\n\t\t\t\t\t\tprops.Metadata = self.objectMetadataDictionary[search.Key]\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback(null, props)\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (err.code === 'ENOENT') {\n\t\t\t\t\t\terr.statusCode = 404\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback(err, search)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tgetObject: function (search, callback) {\n\t\tvar self = this\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\n\t\tif (!callback) {\n\t\t\treturn new FakeStream(search)\n\t\t}\n\t\telse {\n\t\t\tvar path = search.Bucket + '/' + search.Key\n\n\t\t\tfs.readFile(path, function (err, data) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tvar stat = fs.statSync(path)\n\n\t\t\t\t\tvar props = {\n\t\t\t\t\t\tKey: search.Key,\n\t\t\t\t\t\tETag: '\"' + crypto.createHash('md5').update(data).digest('hex') + '\"',\n\t\t\t\t\t\tBody: data,\n\t\t\t\t\t\tLastModified: stat.mtime,\n\t\t\t\t\t\tContentLength: data.length\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.objectMetadataDictionary[search.Key]) {\n\t\t\t\t\t\tprops.Metadata = self.objectMetadataDictionary[search.Key]\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback(null, props)\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (err.code === 'ENOENT') {\n\t\t\t\t\t\treturn callback({\n\t\t\t\t\t\t\tcfId: undefined,\n\t\t\t\t\t\t\tcode: 'NoSuchKey',\n\t\t\t\t\t\t\tmessage: 'The specified key does not exist.',\n\t\t\t\t\t\t\tname: 'NoSuchKey',\n\t\t\t\t\t\t\tregion: null,\n\t\t\t\t\t\t\tstatusCode: 404\n\t\t\t\t\t\t}, search)\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback(err, search)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tcopyObject: function (search, callback) {\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\n\t\tfs.mkdirsSync(path.dirname(search.Bucket + '/' + search.Key))\n\t\tfs.copy(decodeURIComponent(search.CopySource), search.Bucket + '/' + search.Key, function (err, data) {\n\t\t\tcallback(err, search)\n\t\t})\n\t},\n\n\tcreateBucket: function (params, callback) {\n\t\tvar err = null\n\n\t\t// param prop tests - these need to be done here to avoid issues with defaulted values\n\t\tif (typeof (params) === 'object' && params !== null) { // null is an object, at least in older V8's\n\t\t\t// Bucket - required, String\n\t\t\tif (typeof (params.Bucket) !== 'string' || params.Bucket.length <= 0) {\n\t\t\t\t// NOTE: This *will not* match the error provided by the AWS SDK - but that's chasing a moving target\n\t\t\t\terr = new Error(\"Mock-AWS-S3: Argument 'params' must contain a 'Bucket' (String) property\")\n\t\t\t}\n\n\t\t\t// Should we check the remaining props of the params Object? (probably)\n\t\t}\n\t\telse {\n\t\t\terr = new Error(\"Mock-AWS-S3: Argument 'params' must be an Object\")\n\t\t}\n\n\t\t// Note: this.defaultOptions is an object which was passed in to the constructor\n\t\tvar opts = _.extend({}, this.defaultOptions, applyBasePath(params))\n\n\t\t// If the params object is well-formed...\n\t\tif (err === null) {\n\t\t\t// We'll assume that if basePath is set, it's correctly set (i.e. data type etc.) and if not...\n\t\t\t// we'll default to the local dir (which seems to be the existing behaviour - in e.g. putObject)\n\t\t\t// It would be nicer if there were a strongly defined default\n\t\t\tvar bucketPath = opts.basePath || ''\n\t\t\tbucketPath += opts.Bucket\n\n\t\t\tfs.mkdirs(bucketPath, function (err) {\n\t\t\t\treturn callback(err)\n\t\t\t})\n\t\t}\n\t\telse { // ...if the params object is not well-formed, fail fast\n\t\t\treturn callback(err)\n\t\t}\n\t},\n\n\t/**\n\t * Deletes a bucket. Behaviour as createBucket\n\t * @param params {Bucket: bucketName}. Name of bucket to delete\n\t * @param callback\n\t * @returns void\n\t */\n\tdeleteBucket: function (params, callback) {\n\t\tvar err = null\n\n\t\tif (typeof (params) === 'object' && params !== null) {\n\t\t\tif (typeof (params.Bucket) !== 'string' || params.Bucket.length <= 0) {\n\t\t\t\terr = new Error(\"Mock-AWS-S3: Argument 'params' must contain a 'Bucket' (String) property\")\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\terr = new Error(\"Mock-AWS-S3: Argument 'params' must be an Object\")\n\t\t}\n\n\t\tvar opts = _.extend({}, this.defaultOptions, applyBasePath(params))\n\n\t\tif (err !== null) {\n\t\t\tcallback(err)\n\t\t}\n\n\t\tvar bucketPath = opts.basePath || ''\n\t\tbucketPath += opts.Bucket\n\n\t\tfs.remove(bucketPath, function (err) {\n\t\t\treturn callback(err)\n\t\t})\n\t},\n\n\tputObject: function (search, callback) {\n\t\tsearch = _.extend({}, this.defaultOptions, applyBasePath(search))\n\n\t\tif (search.Metadata) {\n\t\t\tthis.objectMetadataDictionary[search.Key] = search.Metadata\n\t\t}\n\n\t\tif (typeof search.Tagging === 'string') {\n\t\t\t// URL query parameter encoded\n\t\t\tvar tags = {}\n\t\t\tvar tagSet = []\n\n\t\t\t// quick'n'dirty parsing into an object (does not support hashes or arrays)\n\t\t\tsearch.Tagging.split('&').forEach(function (part) {\n\t\t\t\tvar item = part.split('=')\n\t\t\t\ttags[decodeURIComponent(item[0])] = decodeURIComponent(item[1])\n\t\t\t})\n\n\t\t\t// expand into tagset\n\t\t\tObject.keys(tags).forEach(function (key) {\n\t\t\t\ttagSet.push({\n\t\t\t\t\tKey: key,\n\t\t\t\t\tValue: tags[key]\n\t\t\t\t})\n\t\t\t})\n\n\t\t\tthis.objectTaggingDictionary[search.Key] = tagSet\n\t\t}\n\n\t\tvar dest = search.Bucket + '/' + search.Key\n\n\t\tvar sendCallback = null\n\n\t\tvar done = function () {\n\t\t\tif (typeof sendCallback === 'function') {\n\t\t\t\tsendCallback.apply(this, arguments)\n\t\t\t}\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback.apply(this, arguments)\n\t\t\t}\n\t\t}\n\n\t\tif (typeof search.Body === 'string') {\n\t\t\tsearch.Body = Buffer.from(search.Body)\n\t\t}\n\n\t\tif (search.Body instanceof Buffer) {\n\t\t\tfs.createFileSync(dest)\n\n\t\t\tfs.writeFile(dest, search.Body, function (err) {\n\t\t\t\tdone(err, { Location: dest, Key: search.Key, Bucket: search.Bucket })\n\t\t\t})\n\t\t}\n\t\telse {\n\t\t\tfs.mkdirsSync(path.dirname(dest))\n\n\t\t\tvar stream = fs.createWriteStream(dest)\n\n\t\t\tstream.on('finish', function () {\n\t\t\t\tdone(null, true)\n\t\t\t})\n\n\t\t\tsearch.Body.on('error', function (err) {\n\t\t\t\tdone(err)\n\t\t\t})\n\n\t\t\tstream.on('error', function (err) {\n\t\t\t\tdone(err)\n\t\t\t})\n\n\t\t\tsearch.Body.pipe(stream)\n\t\t}\n\n\t\treturn {\n\t\t\tsend: function (cb) {\n\t\t\t\tsendCallback = cb\n\t\t\t}\n\t\t}\n\t},\n\n\tgetObjectTagging: function (search, callback) {\n\t\tvar self = this\n\n\t\tthis.headObject(search, function (err, props) {\n\t\t\tif (err) {\n\t\t\t\treturn callback(err)\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn callback(null, {\n\t\t\t\t\tVersionId: '1',\n\t\t\t\t\tTagSet: self.objectTaggingDictionary[search.Key] || []\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t},\n\n\tputObjectTagging: function (search, callback) {\n\t\tvar self = this\n\n\t\tif (!search.Tagging || !search.Tagging.TagSet) {\n\t\t\treturn callback(new Error('Tagging.TagSet required'))\n\t\t}\n\n\t\tthis.headObject(search, function (err, props) {\n\t\t\tif (err) {\n\t\t\t\treturn callback(err)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tself.objectTaggingDictionary[search.Key] = search.Tagging.TagSet\n\n\t\t\t\treturn callback(null, {\n\t\t\t\t\tVersionId: '1'\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t},\n\n\tupload: function (search, options, callback) {\n\t\tif (typeof options === 'function' && callback === undefined) {\n\t\t\tcallback = options\n\t\t\toptions = null\n\t\t}\n\n\t\tif (options && options.tags) {\n\t\t\tif (!Array.isArray(options.tags)) {\n\t\t\t\treturn callback(new Error('Tags must be specified as an array; ' + typeof options.tags + ' provided'))\n\t\t\t}\n\t\t}\n\n\t\treturn this.putObject(search, function (err, data) {\n\t\t\tif (options && options.tags) {\n\t\t\t\t// https://github.com/aws/aws-sdk-js/pull/1425\n\t\t\t\treturn this.putObjectTagging({\n\t\t\t\t\tBucket: search.Bucket,\n\t\t\t\t\tKey: search.Key,\n\t\t\t\t\tTagging: {\n\t\t\t\t\t\tTagSet: options.tags\n\t\t\t\t\t}\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn callback(err)\n\t\t\t\t\t}\n\n\t\t\t\t\treturn callback(null, data)\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn callback(err, data)\n\t\t}.bind(this))\n\t},\n\n\tgetSignedUrl: function (operation, params, callback) {\n\t\tvar url = 'https://s3.us-east-2.amazonaws.com/' +\n\t\t\tparams.Bucket +\n\t\t\t'/' + params.Key +\n\t\t\t'?X-Amz-Date=20170720T182534Z&X-Amz-SignedHeaders=host' +\n\t\t\t'&X-Amz-Credential=ASIAIYLQNVRRFNZOCFBA%2F20170720%2' +\n\t\t\t'Fus-east-2%2Fs3%2Faws4_request&X-Amz-Algorithm=AWS4-HMAC-SHA256&X' +\n\t\t\t'-Amz-Expires=604800&X-Amz-Security-Token=FQoDYXdzEJP%2F%2F%2F%2F%2' +\n\t\t\t'F%2F%2F%2F%2F%2FwEaDOLWx95j90zPxGh7WSLdAVnoYoKC4gjrrR1xbokFWRRwutm' +\n\t\t\t'uAmOxaIVcQqOy%2Fqxy%2FXQt3Iz%2FohuEEmI7%2FHPzShy%2BfgQtvfUeDaojrAx' +\n\t\t\t'5q8fG9P1KuIfcedfkiU%2BCxpM2foyCGlXzoZuNlcF8ohm%2BaM3wh4%2BxQ%2FpSh' +\n\t\t\t'Ll18cKiKEiw0QF1UQGj%2FsiEqzoM81vOSUVWL9SpTTkVq8EQHY1chYKBkBWt7eIQc' +\n\t\t\t'xjTI2dQeYOohlrbnZ5Y1%2F1cxPgrbk6PkNFO3whAoliSjyRC8e4TSjIY2j3V6d9fU' +\n\t\t\t'y4%2Fp6nLZIf9wuERL7xW9PjE6eZbKOHnw8sF&X-Amz-Signature=a14b3065ab82' +\n\t\t\t'2105e8d7892eb5dcc455ddd603c61e47520774a7289178af9ecc'\n\n\t\tswitch (operation) {\n\t\t\tcase 'getObject':\n\t\t\t\tthis.headObject(params, function (err, props) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\terr.statusCode = 404\n\t\t\t\t\t}\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcallback(err, null)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcallback(null, url)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tthrow new Error(err)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn url\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tbreak\n\t\t\tcase 'putObject':\n\t\t\t\tif (!params.Bucket || !params.Key) {\n\t\t\t\t\tthrow new Error({ statusCode: 404 })\n\t\t\t\t}\n\n\t\t\t\treturn url\n\t\t\tdefault:\n\t\t}\n\t}\n}\n\n_.forEach(S3Mock.prototype, function (value, key, obj) {\n\tif (_.isFunction(value)) {\n\t\tobj[key] = createPromisable(value)\n\t}\n})\n\nexports.config = config\n\nexports.S3 = function (options) {\n\treturn new S3Mock(options)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}