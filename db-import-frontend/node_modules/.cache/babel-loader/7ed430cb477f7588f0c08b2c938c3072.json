{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.validateSocksClientChainOptions = exports.validateSocksClientOptions = void 0;\nvar util_1 = require(\"./util\");\nvar constants_1 = require(\"./constants\");\nvar stream = require(\"stream\");\n/**\n * Validates the provided SocksClientOptions\n * @param options { SocksClientOptions }\n * @param acceptedCommands { string[] } A list of accepted SocksProxy commands.\n */\nfunction validateSocksClientOptions(options) {\n  var acceptedCommands = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['connect', 'bind', 'associate'];\n  // Check SOCKs command option.\n  if (!constants_1.SocksCommand[options.command]) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommand, options);\n  }\n  // Check SocksCommand for acceptable command.\n  if (acceptedCommands.indexOf(options.command) === -1) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommandForOperation, options);\n  }\n  // Check destination\n  if (!isValidSocksRemoteHost(options.destination)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsDestination, options);\n  }\n  // Check SOCKS proxy to use\n  if (!isValidSocksProxy(options.proxy)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxy, options);\n  }\n  // Validate custom auth (if set)\n  validateCustomProxyAuth(options.proxy, options);\n  // Check timeout\n  if (options.timeout && !isValidTimeoutValue(options.timeout)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsTimeout, options);\n  }\n  // Check existing_socket (if provided)\n  if (options.existing_socket && !(options.existing_socket instanceof stream.Duplex)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsExistingSocket, options);\n  }\n}\nexports.validateSocksClientOptions = validateSocksClientOptions;\n/**\n * Validates the SocksClientChainOptions\n * @param options { SocksClientChainOptions }\n */\nfunction validateSocksClientChainOptions(options) {\n  // Only connect is supported when chaining.\n  if (options.command !== 'connect') {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommandChain, options);\n  }\n  // Check destination\n  if (!isValidSocksRemoteHost(options.destination)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsDestination, options);\n  }\n  // Validate proxies (length)\n  if (!(options.proxies && Array.isArray(options.proxies) && options.proxies.length >= 2)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxiesLength, options);\n  }\n  // Validate proxies\n  options.proxies.forEach(function (proxy) {\n    if (!isValidSocksProxy(proxy)) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxy, options);\n    }\n    // Validate custom auth (if set)\n    validateCustomProxyAuth(proxy, options);\n  });\n  // Check timeout\n  if (options.timeout && !isValidTimeoutValue(options.timeout)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsTimeout, options);\n  }\n}\nexports.validateSocksClientChainOptions = validateSocksClientChainOptions;\nfunction validateCustomProxyAuth(proxy, options) {\n  if (proxy.custom_auth_method !== undefined) {\n    // Invalid auth method range\n    if (proxy.custom_auth_method < constants_1.SOCKS5_CUSTOM_AUTH_START || proxy.custom_auth_method > constants_1.SOCKS5_CUSTOM_AUTH_END) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthRange, options);\n    }\n    // Missing custom_auth_request_handler\n    if (proxy.custom_auth_request_handler === undefined || typeof proxy.custom_auth_request_handler !== 'function') {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n    // Missing custom_auth_response_size\n    if (proxy.custom_auth_response_size === undefined) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n    // Missing/invalid custom_auth_response_handler\n    if (proxy.custom_auth_response_handler === undefined || typeof proxy.custom_auth_response_handler !== 'function') {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n  }\n}\n/**\n * Validates a SocksRemoteHost\n * @param remoteHost { SocksRemoteHost }\n */\nfunction isValidSocksRemoteHost(remoteHost) {\n  return remoteHost && typeof remoteHost.host === 'string' && typeof remoteHost.port === 'number' && remoteHost.port >= 0 && remoteHost.port <= 65535;\n}\n/**\n * Validates a SocksProxy\n * @param proxy { SocksProxy }\n */\nfunction isValidSocksProxy(proxy) {\n  return proxy && (typeof proxy.host === 'string' || typeof proxy.ipaddress === 'string') && typeof proxy.port === 'number' && proxy.port >= 0 && proxy.port <= 65535 && (proxy.type === 4 || proxy.type === 5);\n}\n/**\n * Validates a timeout value.\n * @param value { Number }\n */\nfunction isValidTimeoutValue(value) {\n  return typeof value === 'number' && value > 0;\n}","map":{"version":3,"names":["util_1","require","constants_1","stream","validateSocksClientOptions","options","acceptedCommands","arguments","length","undefined","SocksCommand","command","SocksClientError","ERRORS","InvalidSocksCommand","indexOf","InvalidSocksCommandForOperation","isValidSocksRemoteHost","destination","InvalidSocksClientOptionsDestination","isValidSocksProxy","proxy","InvalidSocksClientOptionsProxy","validateCustomProxyAuth","timeout","isValidTimeoutValue","InvalidSocksClientOptionsTimeout","existing_socket","Duplex","InvalidSocksClientOptionsExistingSocket","exports","validateSocksClientChainOptions","InvalidSocksCommandChain","proxies","Array","isArray","InvalidSocksClientOptionsProxiesLength","forEach","custom_auth_method","SOCKS5_CUSTOM_AUTH_START","SOCKS5_CUSTOM_AUTH_END","InvalidSocksClientOptionsCustomAuthRange","custom_auth_request_handler","InvalidSocksClientOptionsCustomAuthOptions","custom_auth_response_size","custom_auth_response_handler","remoteHost","host","port","ipaddress","type","value"],"sources":["../../src/common/helpers.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}