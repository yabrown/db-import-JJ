{"ast":null,"code":"/*! @azure/msal-browser v2.37.0 2023-05-01 */\n'use strict';\n\nimport { __awaiter, __generator } from '../_virtual/_tslib.js';\nimport { BrowserStringUtils } from '../utils/BrowserStringUtils.js';\nimport { BrowserAuthError } from '../error/BrowserAuthError.js';\nimport { ModernBrowserCrypto } from './ModernBrowserCrypto.js';\nimport { MsrBrowserCrypto } from './MsrBrowserCrypto.js';\nimport { MsBrowserCrypto } from './MsBrowserCrypto.js';\nimport { BrowserConfigurationAuthError } from '../error/BrowserConfigurationAuthError.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\n/**\r\n * See here for more info on RsaHashedKeyGenParams: https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams\r\n */\n// RSA KeyGen Algorithm\nvar PKCS1_V15_KEYGEN_ALG = \"RSASSA-PKCS1-v1_5\";\n// SHA-256 hashing algorithm\nvar S256_HASH_ALG = \"SHA-256\";\n// MOD length for PoP tokens\nvar MODULUS_LENGTH = 2048;\n// Public Exponent\nvar PUBLIC_EXPONENT = new Uint8Array([0x01, 0x00, 0x01]);\n/**\r\n * This class implements functions used by the browser library to perform cryptography operations such as\r\n * hashing and encoding. It also has helper functions to validate the availability of specific APIs.\r\n */\nvar BrowserCrypto = /** @class */function () {\n  function BrowserCrypto(logger, cryptoOptions) {\n    var _a, _b;\n    this.logger = logger;\n    this.cryptoOptions = cryptoOptions;\n    if (this.hasBrowserCrypto()) {\n      // Use standard modern web crypto if available\n      this.logger.verbose(\"BrowserCrypto: modern crypto interface available\");\n      this.subtleCrypto = new ModernBrowserCrypto();\n    } else if (this.hasIECrypto()) {\n      // For IE11, use msCrypto interface\n      this.logger.verbose(\"BrowserCrypto: MS crypto interface available\");\n      this.subtleCrypto = new MsBrowserCrypto();\n    } else if (this.hasMsrCrypto() && ((_a = this.cryptoOptions) === null || _a === void 0 ? void 0 : _a.useMsrCrypto)) {\n      // For other browsers, use MSR Crypto if found\n      this.logger.verbose(\"BrowserCrypto: MSR crypto interface available\");\n      this.subtleCrypto = new MsrBrowserCrypto();\n    } else {\n      if (this.hasMsrCrypto()) {\n        this.logger.info(\"BrowserCrypto: MSR Crypto interface available but system.cryptoOptions.useMsrCrypto not enabled\");\n      }\n      this.logger.error(\"BrowserCrypto: No crypto interfaces available.\");\n      throw BrowserAuthError.createCryptoNotAvailableError(\"Browser crypto, msCrypto, or msrCrypto interfaces not available.\");\n    }\n    // Mainly needed for MSR Crypto: https://github.com/microsoft/MSR-JavaScript-Crypto#random-number-generator-prng\n    if (this.subtleCrypto.initPrng) {\n      this.logger.verbose(\"BrowserCrypto: Interface requires entropy\");\n      if (!((_b = this.cryptoOptions) === null || _b === void 0 ? void 0 : _b.entropy)) {\n        this.logger.error(\"BrowserCrypto: Interface requires entropy but none provided.\");\n        throw BrowserConfigurationAuthError.createEntropyNotProvided();\n      }\n      this.logger.verbose(\"BrowserCrypto: Entropy provided\");\n      this.subtleCrypto.initPrng(this.cryptoOptions.entropy);\n    }\n    this.keygenAlgorithmOptions = {\n      name: PKCS1_V15_KEYGEN_ALG,\n      hash: S256_HASH_ALG,\n      modulusLength: MODULUS_LENGTH,\n      publicExponent: PUBLIC_EXPONENT\n    };\n  }\n  /**\r\n   * Check whether IE crypto or other browser cryptography is available.\r\n   */\n  BrowserCrypto.prototype.hasIECrypto = function () {\n    return \"msCrypto\" in window;\n  };\n  /**\r\n   * Check whether browser crypto is available.\r\n   */\n  BrowserCrypto.prototype.hasBrowserCrypto = function () {\n    return \"crypto\" in window;\n  };\n  /**\r\n   * Check whether MSR crypto polyfill is available\r\n   */\n  BrowserCrypto.prototype.hasMsrCrypto = function () {\n    return \"msrCrypto\" in window;\n  };\n  /**\r\n   * Returns a sha-256 hash of the given dataString as an ArrayBuffer.\r\n   * @param dataString\r\n   */\n  BrowserCrypto.prototype.sha256Digest = function (dataString) {\n    return __awaiter(this, void 0, void 0, function () {\n      var data;\n      return __generator(this, function (_a) {\n        data = BrowserStringUtils.stringToUtf8Arr(dataString);\n        // MSR Crypto wants object with name property, instead of string\n        return [2 /*return*/, this.subtleCrypto.digest({\n          name: S256_HASH_ALG\n        }, data)];\n      });\n    });\n  };\n  /**\r\n   * Populates buffer with cryptographically random values.\r\n   * @param dataBuffer\r\n   */\n  BrowserCrypto.prototype.getRandomValues = function (dataBuffer) {\n    return this.subtleCrypto.getRandomValues(dataBuffer);\n  };\n  /**\r\n   * Generates a keypair based on current keygen algorithm config.\r\n   * @param extractable\r\n   * @param usages\r\n   */\n  BrowserCrypto.prototype.generateKeyPair = function (extractable, usages) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.subtleCrypto.generateKey(this.keygenAlgorithmOptions, extractable, usages)];\n      });\n    });\n  };\n  /**\r\n   * Export key as Json Web Key (JWK)\r\n   * @param key\r\n   * @param format\r\n   */\n  BrowserCrypto.prototype.exportJwk = function (key) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.subtleCrypto.exportKey(key)];\n      });\n    });\n  };\n  /**\r\n   * Imports key as Json Web Key (JWK), can set extractable and usages.\r\n   * @param key\r\n   * @param format\r\n   * @param extractable\r\n   * @param usages\r\n   */\n  BrowserCrypto.prototype.importJwk = function (key, extractable, usages) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.subtleCrypto.importKey(key, this.keygenAlgorithmOptions, extractable, usages)];\n      });\n    });\n  };\n  /**\r\n   * Signs given data with given key\r\n   * @param key\r\n   * @param data\r\n   */\n  BrowserCrypto.prototype.sign = function (key, data) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.subtleCrypto.sign(this.keygenAlgorithmOptions, key, data)];\n      });\n    });\n  };\n  return BrowserCrypto;\n}();\nexport { BrowserCrypto };","map":{"version":3,"names":["PKCS1_V15_KEYGEN_ALG","S256_HASH_ALG","MODULUS_LENGTH","PUBLIC_EXPONENT","Uint8Array","BrowserCrypto","logger","cryptoOptions","hasBrowserCrypto","verbose","subtleCrypto","ModernBrowserCrypto","hasIECrypto","MsBrowserCrypto","hasMsrCrypto","_a","useMsrCrypto","MsrBrowserCrypto","info","error","BrowserAuthError","createCryptoNotAvailableError","initPrng","_b","entropy","BrowserConfigurationAuthError","createEntropyNotProvided","keygenAlgorithmOptions","name","hash","modulusLength","publicExponent","prototype","window","sha256Digest","dataString","data","BrowserStringUtils","stringToUtf8Arr","digest","getRandomValues","dataBuffer","generateKeyPair","extractable","usages","generateKey","exportJwk","key","exportKey","importJwk","importKey","sign"],"sources":["../../src/crypto/BrowserCrypto.ts"],"sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { BrowserStringUtils } from \"../utils/BrowserStringUtils\";\r\nimport { BrowserAuthError } from \"../error/BrowserAuthError\";\r\nimport { ISubtleCrypto } from \"./ISubtleCrypto\";\r\nimport { ModernBrowserCrypto } from \"./ModernBrowserCrypto\";\r\nimport { MsrBrowserCrypto } from \"./MsrBrowserCrypto\";\r\nimport { MsBrowserCrypto } from \"./MsBrowserCrypto\";\r\nimport { Logger } from \"@azure/msal-common\";\r\nimport { BrowserConfigurationAuthError } from \"../error/BrowserConfigurationAuthError\";\r\nimport { CryptoOptions } from \"../config/Configuration\";\r\n/**\r\n * See here for more info on RsaHashedKeyGenParams: https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams\r\n */\r\n// RSA KeyGen Algorithm\r\nconst PKCS1_V15_KEYGEN_ALG = \"RSASSA-PKCS1-v1_5\";\r\n// SHA-256 hashing algorithm\r\nconst S256_HASH_ALG = \"SHA-256\";\r\n// MOD length for PoP tokens\r\nconst MODULUS_LENGTH = 2048;\r\n// Public Exponent\r\nconst PUBLIC_EXPONENT: Uint8Array = new Uint8Array([0x01, 0x00, 0x01]);\r\n\r\n/**\r\n * This class implements functions used by the browser library to perform cryptography operations such as\r\n * hashing and encoding. It also has helper functions to validate the availability of specific APIs.\r\n */\r\nexport class BrowserCrypto {\r\n\r\n    private keygenAlgorithmOptions: RsaHashedKeyGenParams;\r\n    private subtleCrypto: ISubtleCrypto;\r\n    private logger: Logger;\r\n    private cryptoOptions?: CryptoOptions;\r\n\r\n    constructor(logger: Logger, cryptoOptions?: CryptoOptions) {\r\n        this.logger = logger;\r\n        this.cryptoOptions = cryptoOptions;\r\n\r\n        if (this.hasBrowserCrypto()) {\r\n            // Use standard modern web crypto if available\r\n            this.logger.verbose(\"BrowserCrypto: modern crypto interface available\");\r\n            this.subtleCrypto = new ModernBrowserCrypto();\r\n        } else if (this.hasIECrypto()) {\r\n            // For IE11, use msCrypto interface\r\n            this.logger.verbose(\"BrowserCrypto: MS crypto interface available\");\r\n            this.subtleCrypto = new MsBrowserCrypto();\r\n        } else if (this.hasMsrCrypto() && this.cryptoOptions?.useMsrCrypto) {\r\n            // For other browsers, use MSR Crypto if found\r\n            this.logger.verbose(\"BrowserCrypto: MSR crypto interface available\");\r\n            this.subtleCrypto = new MsrBrowserCrypto();\r\n        } else {\r\n            if (this.hasMsrCrypto()) {\r\n                this.logger.info(\"BrowserCrypto: MSR Crypto interface available but system.cryptoOptions.useMsrCrypto not enabled\");\r\n            }\r\n            this.logger.error(\"BrowserCrypto: No crypto interfaces available.\");\r\n            throw BrowserAuthError.createCryptoNotAvailableError(\"Browser crypto, msCrypto, or msrCrypto interfaces not available.\");\r\n        }\r\n\r\n        // Mainly needed for MSR Crypto: https://github.com/microsoft/MSR-JavaScript-Crypto#random-number-generator-prng\r\n        if (this.subtleCrypto.initPrng) {\r\n            this.logger.verbose(\"BrowserCrypto: Interface requires entropy\");\r\n\r\n            if (!this.cryptoOptions?.entropy) {\r\n                this.logger.error(\"BrowserCrypto: Interface requires entropy but none provided.\");\r\n                throw BrowserConfigurationAuthError.createEntropyNotProvided();\r\n            }\r\n\r\n            this.logger.verbose(\"BrowserCrypto: Entropy provided\");\r\n            this.subtleCrypto.initPrng(this.cryptoOptions.entropy);\r\n        }\r\n\r\n        this.keygenAlgorithmOptions = {\r\n            name: PKCS1_V15_KEYGEN_ALG,\r\n            hash: S256_HASH_ALG,\r\n            modulusLength: MODULUS_LENGTH,\r\n            publicExponent: PUBLIC_EXPONENT\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Check whether IE crypto or other browser cryptography is available.\r\n     */\r\n    private hasIECrypto(): boolean {\r\n        return \"msCrypto\" in window;\r\n    }\r\n\r\n    /**\r\n     * Check whether browser crypto is available.\r\n     */\r\n    private hasBrowserCrypto(): boolean {\r\n        return \"crypto\" in window;\r\n    }\r\n\r\n    /**\r\n     * Check whether MSR crypto polyfill is available\r\n     */\r\n    private hasMsrCrypto(): boolean {\r\n        return \"msrCrypto\" in window;\r\n    }\r\n\r\n    /**\r\n     * Returns a sha-256 hash of the given dataString as an ArrayBuffer.\r\n     * @param dataString \r\n     */\r\n    async sha256Digest(dataString: string): Promise<ArrayBuffer> {\r\n        const data = BrowserStringUtils.stringToUtf8Arr(dataString);\r\n        // MSR Crypto wants object with name property, instead of string\r\n        return this.subtleCrypto.digest({ name: S256_HASH_ALG }, data);\r\n    }\r\n\r\n    /**\r\n     * Populates buffer with cryptographically random values.\r\n     * @param dataBuffer \r\n     */\r\n    getRandomValues(dataBuffer: Uint8Array): Uint8Array {\r\n        return this.subtleCrypto.getRandomValues(dataBuffer);\r\n    }\r\n\r\n    /**\r\n     * Generates a keypair based on current keygen algorithm config.\r\n     * @param extractable \r\n     * @param usages \r\n     */\r\n    async generateKeyPair(extractable: boolean, usages: Array<KeyUsage>): Promise<CryptoKeyPair> {\r\n        return this.subtleCrypto.generateKey(this.keygenAlgorithmOptions, extractable, usages);\r\n    }\r\n\r\n    /**\r\n     * Export key as Json Web Key (JWK)\r\n     * @param key \r\n     * @param format \r\n     */\r\n    async exportJwk(key: CryptoKey): Promise<JsonWebKey> {\r\n        return this.subtleCrypto.exportKey(key);\r\n    }\r\n\r\n    /**\r\n     * Imports key as Json Web Key (JWK), can set extractable and usages.\r\n     * @param key \r\n     * @param format \r\n     * @param extractable \r\n     * @param usages \r\n     */\r\n    async importJwk(key: JsonWebKey, extractable: boolean, usages: Array<KeyUsage>): Promise<CryptoKey> {\r\n        return this.subtleCrypto.importKey(key, this.keygenAlgorithmOptions, extractable, usages);\r\n    }\r\n\r\n    /**\r\n     * Signs given data with given key\r\n     * @param key \r\n     * @param data \r\n     */\r\n    async sign(key: CryptoKey, data: ArrayBuffer): Promise<ArrayBuffer> {\r\n        return this.subtleCrypto.sign(this.keygenAlgorithmOptions, key, data);\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}