{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { AbortError } from \"@azure/abort-controller\";\nvar StandardAbortMessage = \"The operation was aborted.\";\n/**\n * A wrapper for setTimeout that resolves a promise after delayInMs milliseconds.\n * @param delayInMs - The number of milliseconds to be delayed.\n * @param value - The value to be resolved with after a timeout of t milliseconds.\n * @param options - The options for delay - currently abort options\n *                  - abortSignal - The abortSignal associated with containing operation.\n *                  - abortErrorMsg - The abort error message associated with containing operation.\n * @returns Resolved promise\n */\nexport function delay(delayInMs, value, options) {\n  return new Promise(function (resolve, reject) {\n    var timer = undefined;\n    var onAborted = undefined;\n    var rejectOnAbort = function rejectOnAbort() {\n      return reject(new AbortError((options === null || options === void 0 ? void 0 : options.abortErrorMsg) ? options === null || options === void 0 ? void 0 : options.abortErrorMsg : StandardAbortMessage));\n    };\n    var removeListeners = function removeListeners() {\n      if ((options === null || options === void 0 ? void 0 : options.abortSignal) && onAborted) {\n        options.abortSignal.removeEventListener(\"abort\", onAborted);\n      }\n    };\n    onAborted = function onAborted() {\n      if (timer) {\n        clearTimeout(timer);\n      }\n      removeListeners();\n      return rejectOnAbort();\n    };\n    if ((options === null || options === void 0 ? void 0 : options.abortSignal) && options.abortSignal.aborted) {\n      return rejectOnAbort();\n    }\n    timer = setTimeout(function () {\n      removeListeners();\n      resolve(value);\n    }, delayInMs);\n    if (options === null || options === void 0 ? void 0 : options.abortSignal) {\n      options.abortSignal.addEventListener(\"abort\", onAborted);\n    }\n  });\n}\n/**\n * @internal\n * @returns the parsed value or undefined if the parsed value is invalid.\n */\nexport function parseHeaderValueAsNumber(response, headerName) {\n  var value = response.headers.get(headerName);\n  if (!value) return;\n  var valueAsNum = Number(value);\n  if (Number.isNaN(valueAsNum)) return;\n  return valueAsNum;\n}","map":{"version":3,"names":["AbortError","StandardAbortMessage","delay","delayInMs","value","options","Promise","resolve","reject","timer","undefined","onAborted","rejectOnAbort","abortErrorMsg","removeListeners","abortSignal","removeEventListener","clearTimeout","aborted","setTimeout","addEventListener","parseHeaderValueAsNumber","response","headerName","headers","get","valueAsNum","Number","isNaN"],"sources":["../../../src/util/helpers.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { AbortError, AbortSignalLike } from \"@azure/abort-controller\";\nimport { PipelineResponse } from \"../interfaces\";\n\nconst StandardAbortMessage = \"The operation was aborted.\";\n\n/**\n * A wrapper for setTimeout that resolves a promise after delayInMs milliseconds.\n * @param delayInMs - The number of milliseconds to be delayed.\n * @param value - The value to be resolved with after a timeout of t milliseconds.\n * @param options - The options for delay - currently abort options\n *                  - abortSignal - The abortSignal associated with containing operation.\n *                  - abortErrorMsg - The abort error message associated with containing operation.\n * @returns Resolved promise\n */\nexport function delay<T>(\n  delayInMs: number,\n  value?: T,\n  options?: {\n    abortSignal?: AbortSignalLike;\n    abortErrorMsg?: string;\n  }\n): Promise<T | void> {\n  return new Promise((resolve, reject) => {\n    let timer: ReturnType<typeof setTimeout> | undefined = undefined;\n    let onAborted: (() => void) | undefined = undefined;\n\n    const rejectOnAbort = (): void => {\n      return reject(\n        new AbortError(options?.abortErrorMsg ? options?.abortErrorMsg : StandardAbortMessage)\n      );\n    };\n\n    const removeListeners = (): void => {\n      if (options?.abortSignal && onAborted) {\n        options.abortSignal.removeEventListener(\"abort\", onAborted);\n      }\n    };\n\n    onAborted = (): void => {\n      if (timer) {\n        clearTimeout(timer);\n      }\n      removeListeners();\n      return rejectOnAbort();\n    };\n\n    if (options?.abortSignal && options.abortSignal.aborted) {\n      return rejectOnAbort();\n    }\n\n    timer = setTimeout(() => {\n      removeListeners();\n      resolve(value);\n    }, delayInMs);\n\n    if (options?.abortSignal) {\n      options.abortSignal.addEventListener(\"abort\", onAborted);\n    }\n  });\n}\n\n/**\n * @internal\n * @returns the parsed value or undefined if the parsed value is invalid.\n */\nexport function parseHeaderValueAsNumber(\n  response: PipelineResponse,\n  headerName: string\n): number | undefined {\n  const value = response.headers.get(headerName);\n  if (!value) return;\n  const valueAsNum = Number(value);\n  if (Number.isNaN(valueAsNum)) return;\n  return valueAsNum;\n}\n"],"mappings":"AAAA;AACA;AAEA,SAASA,UAAU,QAAyB,yBAAyB;AAGrE,IAAMC,oBAAoB,GAAG,4BAA4B;AAEzD;;;;;;;;;AASA,OAAM,SAAUC,KAAKA,CACnBC,SAAiB,EACjBC,KAAS,EACTC,OAGC;EAED,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAI;IACrC,IAAIC,KAAK,GAA8CC,SAAS;IAChE,IAAIC,SAAS,GAA6BD,SAAS;IAEnD,IAAME,aAAa,GAAG,SAAhBA,aAAaA,CAAA,EAAc;MAC/B,OAAOJ,MAAM,CACX,IAAIR,UAAU,CAAC,CAAAK,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEQ,aAAa,IAAGR,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEQ,aAAa,GAAGZ,oBAAoB,CAAC,CACvF;IACH,CAAC;IAED,IAAMa,eAAe,GAAG,SAAlBA,eAAeA,CAAA,EAAc;MACjC,IAAI,CAAAT,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEU,WAAW,KAAIJ,SAAS,EAAE;QACrCN,OAAO,CAACU,WAAW,CAACC,mBAAmB,CAAC,OAAO,EAAEL,SAAS,CAAC;;IAE/D,CAAC;IAEDA,SAAS,GAAG,SAAAA,UAAA,EAAW;MACrB,IAAIF,KAAK,EAAE;QACTQ,YAAY,CAACR,KAAK,CAAC;;MAErBK,eAAe,EAAE;MACjB,OAAOF,aAAa,EAAE;IACxB,CAAC;IAED,IAAI,CAAAP,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEU,WAAW,KAAIV,OAAO,CAACU,WAAW,CAACG,OAAO,EAAE;MACvD,OAAON,aAAa,EAAE;;IAGxBH,KAAK,GAAGU,UAAU,CAAC,YAAK;MACtBL,eAAe,EAAE;MACjBP,OAAO,CAACH,KAAK,CAAC;IAChB,CAAC,EAAED,SAAS,CAAC;IAEb,IAAIE,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEU,WAAW,EAAE;MACxBV,OAAO,CAACU,WAAW,CAACK,gBAAgB,CAAC,OAAO,EAAET,SAAS,CAAC;;EAE5D,CAAC,CAAC;AACJ;AAEA;;;;AAIA,OAAM,SAAUU,wBAAwBA,CACtCC,QAA0B,EAC1BC,UAAkB;EAElB,IAAMnB,KAAK,GAAGkB,QAAQ,CAACE,OAAO,CAACC,GAAG,CAACF,UAAU,CAAC;EAC9C,IAAI,CAACnB,KAAK,EAAE;EACZ,IAAMsB,UAAU,GAAGC,MAAM,CAACvB,KAAK,CAAC;EAChC,IAAIuB,MAAM,CAACC,KAAK,CAACF,UAAU,CAAC,EAAE;EAC9B,OAAOA,UAAU;AACnB"},"metadata":{},"sourceType":"module"}