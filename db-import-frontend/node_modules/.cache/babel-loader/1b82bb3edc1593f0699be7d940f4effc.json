{"ast":null,"code":"\"use strict\";\n\nvar uuidv4 = require(\"uuid\").v4;\nvar TransactionQueries = {\n  setIsolationLevelQuery: function setIsolationLevelQuery(value, options) {\n    if (options.parent) {\n      return;\n    }\n    return \"SET TRANSACTION ISOLATION LEVEL \".concat(value, \";\");\n  },\n  generateTransactionId: function generateTransactionId() {\n    return uuidv4();\n  },\n  startTransactionQuery: function startTransactionQuery(transaction) {\n    if (transaction.parent) {\n      return \"SAVEPOINT \".concat(this.quoteIdentifier(transaction.name, true), \";\");\n    }\n    return \"START TRANSACTION;\";\n  },\n  deferConstraintsQuery: function deferConstraintsQuery() {},\n  setConstraintQuery: function setConstraintQuery() {},\n  setDeferredQuery: function setDeferredQuery() {},\n  setImmediateQuery: function setImmediateQuery() {},\n  commitTransactionQuery: function commitTransactionQuery(transaction) {\n    if (transaction.parent) {\n      return;\n    }\n    return \"COMMIT;\";\n  },\n  rollbackTransactionQuery: function rollbackTransactionQuery(transaction) {\n    if (transaction.parent) {\n      return \"ROLLBACK TO SAVEPOINT \".concat(this.quoteIdentifier(transaction.name, true), \";\");\n    }\n    return \"ROLLBACK;\";\n  }\n};\nmodule.exports = TransactionQueries;","map":{"version":3,"names":["uuidv4","require","v4","TransactionQueries","setIsolationLevelQuery","value","options","parent","concat","generateTransactionId","startTransactionQuery","transaction","quoteIdentifier","name","deferConstraintsQuery","setConstraintQuery","setDeferredQuery","setImmediateQuery","commitTransactionQuery","rollbackTransactionQuery","module","exports"],"sources":["../../../../src/dialects/abstract/query-generator/transaction.js"],"sourcesContent":["'use strict';\n\nconst uuidv4 = require('uuid').v4;\n\nconst TransactionQueries = {\n  /**\n   * Returns a query that sets the transaction isolation level.\n   *\n   * @param  {string} value   The isolation level.\n   * @param  {object} options An object with options.\n   * @returns {string}         The generated sql query.\n   * @private\n   */\n  setIsolationLevelQuery(value, options) {\n    if (options.parent) {\n      return;\n    }\n\n    return `SET TRANSACTION ISOLATION LEVEL ${value};`;\n  },\n\n  generateTransactionId() {\n    return uuidv4();\n  },\n\n  /**\n   * Returns a query that starts a transaction.\n   *\n   * @param  {Transaction} transaction\n   * @returns {string}         The generated sql query.\n   * @private\n   */\n  startTransactionQuery(transaction) {\n    if (transaction.parent) {\n      // force quoting of savepoint identifiers for postgres\n      return `SAVEPOINT ${this.quoteIdentifier(transaction.name, true)};`;\n    }\n\n    return 'START TRANSACTION;';\n  },\n\n  deferConstraintsQuery() {},\n\n  setConstraintQuery() {},\n  setDeferredQuery() {},\n  setImmediateQuery() {},\n\n  /**\n   * Returns a query that commits a transaction.\n   *\n   * @param  {Transaction} transaction An object with options.\n   * @returns {string}         The generated sql query.\n   * @private\n   */\n  commitTransactionQuery(transaction) {\n    if (transaction.parent) {\n      return;\n    }\n\n    return 'COMMIT;';\n  },\n\n  /**\n   * Returns a query that rollbacks a transaction.\n   *\n   * @param  {Transaction} transaction\n   * @returns {string}         The generated sql query.\n   * @private\n   */\n  rollbackTransactionQuery(transaction) {\n    if (transaction.parent) {\n      // force quoting of savepoint identifiers for postgres\n      return `ROLLBACK TO SAVEPOINT ${this.quoteIdentifier(transaction.name, true)};`;\n    }\n\n    return 'ROLLBACK;';\n  }\n};\n\nmodule.exports = TransactionQueries;\n"],"mappings":";;AAEA,IAAMA,MAAA,GAASC,OAAA,CAAQ,QAAQC,EAAA;AAE/B,IAAMC,kBAAA,GAAqB;EASzBC,sBAAA,WAAAA,uBAAuBC,KAAA,EAAOC,OAAA,EAAS;IACrC,IAAIA,OAAA,CAAQC,MAAA,EAAQ;MAClB;IAAA;IAGF,0CAAAC,MAAA,CAA0CH,KAAA;EAAA;EAG5CI,qBAAA,WAAAA,sBAAA,EAAwB;IACtB,OAAOT,MAAA;EAAA;EAUTU,qBAAA,WAAAA,sBAAsBC,WAAA,EAAa;IACjC,IAAIA,WAAA,CAAYJ,MAAA,EAAQ;MAEtB,oBAAAC,MAAA,CAAoB,KAAKI,eAAA,CAAgBD,WAAA,CAAYE,IAAA,EAAM;IAAA;IAG7D,OAAO;EAAA;EAGTC,qBAAA,WAAAA,sBAAA,EAAwB;EAExBC,kBAAA,WAAAA,mBAAA,EAAqB;EACrBC,gBAAA,WAAAA,iBAAA,EAAmB;EACnBC,iBAAA,WAAAA,kBAAA,EAAoB;EASpBC,sBAAA,WAAAA,uBAAuBP,WAAA,EAAa;IAClC,IAAIA,WAAA,CAAYJ,MAAA,EAAQ;MACtB;IAAA;IAGF,OAAO;EAAA;EAUTY,wBAAA,WAAAA,yBAAyBR,WAAA,EAAa;IACpC,IAAIA,WAAA,CAAYJ,MAAA,EAAQ;MAEtB,gCAAAC,MAAA,CAAgC,KAAKI,eAAA,CAAgBD,WAAA,CAAYE,IAAA,EAAM;IAAA;IAGzE,OAAO;EAAA;AAAA;AAIXO,MAAA,CAAOC,OAAA,GAAUlB,kBAAA"},"metadata":{},"sourceType":"script"}