{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { createClientLogger } from \"@azure/logger\";\n/**\n * The AzureLogger used for all clients within the identity package\n */\nexport var logger = createClientLogger(\"identity\");\n/**\n * Separates a list of environment variable names into a plain object with two arrays: an array of missing environment variables and another array with assigned environment variables.\n * @param supportedEnvVars - List of environment variable names\n */\nexport function processEnvVars(supportedEnvVars) {\n  return supportedEnvVars.reduce(function (acc, envVariable) {\n    if (process.env[envVariable]) {\n      acc.assigned.push(envVariable);\n    } else {\n      acc.missing.push(envVariable);\n    }\n    return acc;\n  }, {\n    missing: [],\n    assigned: []\n  });\n}\n/**\n * Based on a given list of environment variable names,\n * logs the environment variables currently assigned during the usage of a credential that goes by the given name.\n * @param credentialName - Name of the credential in use\n * @param supportedEnvVars - List of environment variables supported by that credential\n */\nexport function logEnvVars(credentialName, supportedEnvVars) {\n  var _processEnvVars = processEnvVars(supportedEnvVars),\n    assigned = _processEnvVars.assigned;\n  logger.info(\"\".concat(credentialName, \" => Found the following environment variables: \").concat(assigned.join(\", \")));\n}\n/**\n * Formatting the success event on the credentials\n */\nexport function formatSuccess(scope) {\n  return \"SUCCESS. Scopes: \".concat(Array.isArray(scope) ? scope.join(\", \") : scope, \".\");\n}\n/**\n * Formatting the success event on the credentials\n */\nexport function formatError(scope, error) {\n  var message = \"ERROR.\";\n  if (scope === null || scope === void 0 ? void 0 : scope.length) {\n    message += \" Scopes: \".concat(Array.isArray(scope) ? scope.join(\", \") : scope, \".\");\n  }\n  return \"\".concat(message, \" Error message: \").concat(typeof error === \"string\" ? error : error.message, \".\");\n}\n/**\n * Generates a CredentialLoggerInstance.\n *\n * It logs with the format:\n *\n *   `[title] => [message]`\n *\n */\nexport function credentialLoggerInstance(title, parent) {\n  var log = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : logger;\n  var fullTitle = parent ? \"\".concat(parent.fullTitle, \" \").concat(title) : title;\n  function info(message) {\n    log.info(\"\".concat(fullTitle, \" =>\"), message);\n  }\n  function warning(message) {\n    log.warning(\"\".concat(fullTitle, \" =>\"), message);\n  }\n  return {\n    title: title,\n    fullTitle: fullTitle,\n    info: info,\n    warning: warning\n  };\n}\n/**\n * Generates a CredentialLogger, which is a logger declared at the credential's constructor, and used at any point in the credential.\n * It has all the properties of a CredentialLoggerInstance, plus other logger instances, one per method.\n *\n * It logs with the format:\n *\n *   `[title] => [message]`\n *   `[title] => getToken() => [message]`\n *\n */\nexport function credentialLogger(title) {\n  var log = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : logger;\n  var credLogger = credentialLoggerInstance(title, undefined, log);\n  return Object.assign(Object.assign({}, credLogger), {\n    parent: log,\n    getToken: credentialLoggerInstance(\"=> getToken()\", credLogger, log)\n  });\n}","map":{"version":3,"names":["createClientLogger","logger","processEnvVars","supportedEnvVars","reduce","acc","envVariable","process","env","assigned","push","missing","logEnvVars","credentialName","_processEnvVars","info","concat","join","formatSuccess","scope","Array","isArray","formatError","error","message","length","credentialLoggerInstance","title","parent","log","arguments","undefined","fullTitle","warning","credentialLogger","credLogger","Object","assign","getToken"],"sources":["../../../src/util/logging.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { AzureLogger, createClientLogger } from \"@azure/logger\";\n\n/**\n * The AzureLogger used for all clients within the identity package\n */\nexport const logger = createClientLogger(\"identity\");\n\ninterface EnvironmentAccumulator {\n  missing: string[];\n  assigned: string[];\n}\n\n/**\n * Separates a list of environment variable names into a plain object with two arrays: an array of missing environment variables and another array with assigned environment variables.\n * @param supportedEnvVars - List of environment variable names\n */\nexport function processEnvVars(supportedEnvVars: string[]): EnvironmentAccumulator {\n  return supportedEnvVars.reduce(\n    (acc: EnvironmentAccumulator, envVariable: string) => {\n      if (process.env[envVariable]) {\n        acc.assigned.push(envVariable);\n      } else {\n        acc.missing.push(envVariable);\n      }\n      return acc;\n    },\n    { missing: [], assigned: [] }\n  );\n}\n\n/**\n * Based on a given list of environment variable names,\n * logs the environment variables currently assigned during the usage of a credential that goes by the given name.\n * @param credentialName - Name of the credential in use\n * @param supportedEnvVars - List of environment variables supported by that credential\n */\nexport function logEnvVars(credentialName: string, supportedEnvVars: string[]): void {\n  const { assigned } = processEnvVars(supportedEnvVars);\n  logger.info(\n    `${credentialName} => Found the following environment variables: ${assigned.join(\", \")}`\n  );\n}\n\n/**\n * Formatting the success event on the credentials\n */\nexport function formatSuccess(scope: string | string[]): string {\n  return `SUCCESS. Scopes: ${Array.isArray(scope) ? scope.join(\", \") : scope}.`;\n}\n\n/**\n * Formatting the success event on the credentials\n */\nexport function formatError(scope: string | string[] | undefined, error: Error | string): string {\n  let message = \"ERROR.\";\n  if (scope?.length) {\n    message += ` Scopes: ${Array.isArray(scope) ? scope.join(\", \") : scope}.`;\n  }\n  return `${message} Error message: ${typeof error === \"string\" ? error : error.message}.`;\n}\n\n/**\n * A CredentialLoggerInstance is a logger properly formatted to work in a credential's constructor, and its methods.\n */\nexport interface CredentialLoggerInstance {\n  title: string;\n  fullTitle: string;\n  info(message: string): void;\n  warning(message: string): void;\n  /**\n   * The logging functions for warning and error are intentionally left out, since we want the identity logging to be at the info level.\n   * Otherwise, they would look like:\n   *\n   *   warning(message: string): void;\n   *   error(err: Error): void;\n   */\n}\n\n/**\n * Generates a CredentialLoggerInstance.\n *\n * It logs with the format:\n *\n *   `[title] => [message]`\n *\n */\nexport function credentialLoggerInstance(\n  title: string,\n  parent?: CredentialLoggerInstance,\n  log: AzureLogger = logger\n): CredentialLoggerInstance {\n  const fullTitle = parent ? `${parent.fullTitle} ${title}` : title;\n\n  function info(message: string): void {\n    log.info(`${fullTitle} =>`, message);\n  }\n\n  function warning(message: string): void {\n    log.warning(`${fullTitle} =>`, message);\n  }\n  return {\n    title,\n    fullTitle,\n    info,\n    warning,\n  };\n}\n\n/**\n * A CredentialLogger is a logger declared at the credential's constructor, and used at any point in the credential.\n * It has all the properties of a CredentialLoggerInstance, plus other logger instances, one per method.\n */\nexport interface CredentialLogger extends CredentialLoggerInstance {\n  parent: AzureLogger;\n  getToken: CredentialLoggerInstance;\n}\n\n/**\n * Generates a CredentialLogger, which is a logger declared at the credential's constructor, and used at any point in the credential.\n * It has all the properties of a CredentialLoggerInstance, plus other logger instances, one per method.\n *\n * It logs with the format:\n *\n *   `[title] => [message]`\n *   `[title] => getToken() => [message]`\n *\n */\nexport function credentialLogger(title: string, log: AzureLogger = logger): CredentialLogger {\n  const credLogger = credentialLoggerInstance(title, undefined, log);\n  return {\n    ...credLogger,\n    parent: log,\n    getToken: credentialLoggerInstance(\"=> getToken()\", credLogger, log),\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}